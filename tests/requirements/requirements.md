# QA-SRS026 ClickHouse Operator
# Software Requirements Specification

(c) 2021 Altinity Inc. All Rights Reserved.

**Document status:** Confidential

**Author:** vzakaznikov

**Date:** October 8, 2021

## Approval

**Status:** -

**Version:** -

**Approved by:** -

**Date:** -

## Table of Contents

* 1 [Revision History](#revision-history)
* 2 [Introduction](#introduction)
* 3 [Definitions](#definitions)
  * 3.1 [PV](#pv)
  * 3.2 [CSI](#csi)
  * 3.3 [Operator](#operator)
  * 3.4 [Deployment](#deployment)
  * 3.5 [Namespace](#namespace)
  * 3.6 [OLM](#olm)
  * 3.7 [Pod](#pod)
  * 3.8 [ReplicaSet](#replicaset)
  * 3.9 [Service](#service)
  * 3.10 [PVC](#pvc)
  * 3.11 [CHI](#chi)
  * 3.12 [Shard](#shard)
  * 3.13 [Replica](#replica)
  * 3.14 [ConfigMap](#configmap)
  * 3.15 [StatefulSet](#statefulset)
  * 3.16 [`bool enum` Type](#bool-enum-type)
  * 3.17 [`string` Type](#string-type)
  * 3.18 [`integer` Type](#integer-type)
  * 3.19 [`array` Type](#array-type)
* 4 [Requirements](#requirements)
  * 4.1 [General](#general)
      * 4.1.0.1 [RQ.SRS-026.ClickHouseOperator](#rqsrs-026clickhouseoperator)
  * 4.2 [Installation](#installation)
    * 4.2.1 [RQ.SRS-026.ClickHouseOperator.Installation](#rqsrs-026clickhouseoperatorinstallation)
    * 4.2.2 [Monitoring Support](#monitoring-support)
      * 4.2.2.1 [RQ.SRS-026.ClickHouseOperator.Installation.MonitoringSupport](#rqsrs-026clickhouseoperatorinstallationmonitoringsupport)
  * 4.3 [Namespaces](#namespaces)
    * 4.3.1 [Kube System](#kube-system)
      * 4.3.1.1 [RQ.SRS-026.ClickHouseOperator.Namespaces.KubeSystem](#rqsrs-026clickhouseoperatornamespaceskubesystem)
    * 4.3.2 [User Defined](#user-defined)
      * 4.3.2.1 [RQ.SRS-026.ClickHouseOperator.Namespaces.UserDefined](#rqsrs-026clickhouseoperatornamespacesuserdefined)
    * 4.3.3 [Cluster Management](#cluster-management)
      * 4.3.3.1 [RQ.SRS-026.ClickHouseOperator.Namespaces.ClusterManagement](#rqsrs-026clickhouseoperatornamespacesclustermanagement)
  * 4.4 [ACM Compatibility](#acm-compatibility)
      * 4.4.3.1 [RQ.SRS-026.ClickHouseOperator.ACM](#rqsrs-026clickhouseoperatoracm)
  * 4.5 [Creating Clusters](#creating-clusters)
      * 4.5.3.1 [RQ.SRS-026.ClickHouseOperator.Create](#rqsrs-026clickhouseoperatorcreate)
      * 4.5.3.2 [RQ.SRS-026.ClickHouseOperator.DeleteBroken](#rqsrs-026clickhouseoperatordeletebroken)
  * 4.6 [Auto-generated ClickHouse Clusters Definitions](#auto-generated-clickhouse-clusters-definitions)
    * 4.6.1 [RQ.SRS-026.ClickHouseOperator.AutoGeneratedClickHouseClusters](#rqsrs-026clickhouseoperatorautogeneratedclickhouseclusters)
  * 4.7 [Managing Operator](#managing-operator)
    * 4.7.1 [Upgrading Operator](#upgrading-operator)
      * 4.7.1.1 [RQ.SRS-026.ClickHouseOperator.Managing.UpgradingOperator](#rqsrs-026clickhouseoperatormanagingupgradingoperator)
    * 4.7.2 [Downgrading Operator](#downgrading-operator)
      * 4.7.2.1 [RQ.SRS-026.ClickHouseOperator.Managing.DowngradingOperator](#rqsrs-026clickhouseoperatormanagingdowngradingoperator)
    * 4.7.3 [Restaring Operator](#restaring-operator)
      * 4.7.3.1 [RQ.SRS-026.ClickHouseOperator.Managing.RestartingOperator](#rqsrs-026clickhouseoperatormanagingrestartingoperator)
  * 4.8 [Security](#security)
    * 4.8.1 [Default Access Control](#default-access-control)
      * 4.8.1.1 [RQ.SRS-026.ClickHouseOperator.DefaultAccessControl](#rqsrs-026clickhouseoperatordefaultaccesscontrol)
    * 4.8.2 [Default Users](#default-users)
      * 4.8.2.1 [RQ.SRS-026.ClickHouseOperator.DefaultUsers](#rqsrs-026clickhouseoperatordefaultusers)
    * 4.8.3 [Secrets](#secrets)
      * 4.8.3.1 [RQ.SRS-026.ClickHouseOperator.Secrets](#rqsrs-026clickhouseoperatorsecrets)
    * 4.8.4 [Secure Connection](#secure-connection)
      * 4.8.4.1 [RQ.SRS-026.ClickHouseOperator.EnableHttps](#rqsrs-026clickhouseoperatorenablehttps)
      * 4.8.4.2 [RQ.SRS-026.ClickHouseOperator.CHI.ConnectWithHttps](#rqsrs-026clickhouseoperatorchiconnectwithhttps)
  * 4.9 [Default Templates](#default-templates)
    * 4.9.1 [RQ.SRS-026.ClickHouseOperator.DefaultTemplates](#rqsrs-026clickhouseoperatordefaulttemplates)
    * 4.9.2 [RQ.SRS-026.ClickHouseOperator.DefaultTemplates.MergingWithUserDefinedTemplates](#rqsrs-026clickhouseoperatordefaulttemplatesmergingwithuserdefinedtemplates)
  * 4.10 [Annotations In Templates](#annotations-in-templates)
    * 4.10.1 [RQ.SRS-026.ClickHouseOperator.AnnotationsInTemplates](#rqsrs-026clickhouseoperatorannotationsintemplates)
  * 4.11 [Custom Pod Templates](#custom-pod-templates)
      * 4.11.1.1 [RQ.SRS-026.ClickHouseOperator.PodTemplates](#rqsrs-026clickhouseoperatorpodtemplates)
  * 4.12 [Custom Service Templates](#custom-service-templates)
    * 4.12.1 [RQ.SRS-026.ClickHouseOperator.ServiceTemplates](#rqsrs-026clickhouseoperatorservicetemplates)
    * 4.12.2 [Load Balancer](#load-balancer)
      * 4.12.2.1 [RQ.SRS-026.ClickHouseOperator.ServiceTemplates.LoadBalancer](#rqsrs-026clickhouseoperatorservicetemplatesloadbalancer)
    * 4.12.3 [Standard Kubernetes Service Specification](#standard-kubernetes-service-specification)
      * 4.12.3.1 [RQ.SRS-026.ClickHouseOperator.ServiceTemplates.ServiceSpecificationStandard](#rqsrs-026clickhouseoperatorservicetemplatesservicespecificationstandard)
    * 4.12.4 [Annotations](#annotations)
      * 4.12.4.1 [RQ.SRS-026.ClickHouseOperator.ServiceTemplates.Annotations](#rqsrs-026clickhouseoperatorservicetemplatesannotations)
    * 4.12.5 [Name Generation](#name-generation)
      * 4.12.5.1 [RQ.SRS-026.ClickHouseOperator.ServiceTemplates.NameGeneration](#rqsrs-026clickhouseoperatorservicetemplatesnamegeneration)
  * 4.13 [Custom Host Template](#custom-host-template)
      * 4.13.5.1 [RQ.SRS-026.ClickHouseOperator.HostTemplates](#rqsrs-026clickhouseoperatorhosttemplates)
  * 4.14 [Custom Volume Claim Templates](#custom-volume-claim-templates)
      * 4.14.5.1 [RQ.SRS-026.ClickHouseOperator.VolumeClaimTamplates](#rqsrs-026clickhouseoperatorvolumeclaimtamplates)
  * 4.15 [Storage Provisioning](#storage-provisioning)
      * 4.15.5.1 [RQ.SRS-026.ClickHouseOperator.StorageProvisioning](#rqsrs-026clickhouseoperatorstorageprovisioning)
  * 4.16 [Deployments](#deployments)
    * 4.16.1 [Single Node Instances](#single-node-instances)
      * 4.16.1.1 [RQ.SRS-026.ClickHouseOperator.Deployments.SingleNodeInstances](#rqsrs-026clickhouseoperatordeploymentssinglenodeinstances)
    * 4.16.2 [Multiple Shards](#multiple-shards)
      * 4.16.2.1 [RQ.SRS-026.ClickHouseOperator.Deployments.MultipleShards](#rqsrs-026clickhouseoperatordeploymentsmultipleshards)
    * 4.16.3 [Multiple Replicas](#multiple-replicas)
      * 4.16.3.1 [RQ.SRS-026.ClickHouseOperator.Deployments.MultipleReplicas](#rqsrs-026clickhouseoperatordeploymentsmultiplereplicas)
    * 4.16.4 [Multiple Shards And Replicas](#multiple-shards-and-replicas)
      * 4.16.4.1 [RQ.SRS-026.ClickHouseOperator.Deployments.MultipleShardsAndReplicas](#rqsrs-026clickhouseoperatordeploymentsmultipleshardsandreplicas)
    * 4.16.5 [Multiple Clusters](#multiple-clusters)
      * 4.16.5.1 [RQ.SRS-026.ClickHouseOperator.Deployments.MultipleClusters](#rqsrs-026clickhouseoperatordeploymentsmultipleclusters)
    * 4.16.6 [Circular Replication](#circular-replication)
      * 4.16.6.1 [RQ.SRS-026.ClickHouseOperator.Deployments.CircularReplication](#rqsrs-026clickhouseoperatordeploymentscircularreplication)
    * 4.16.7 [Different ClickHouse Versions On Replicas And Shards](#different-clickhouse-versions-on-replicas-and-shards)
      * 4.16.7.1 [RQ.SRS-026.ClickHouseOperator.Deployments.DifferentClickHouseVersionsOnReplicasAndShards](#rqsrs-026clickhouseoperatordeploymentsdifferentclickhouseversionsonreplicasandshards)
    * 4.16.8 [Multiple Storage Volumes](#multiple-storage-volumes)
      * 4.16.8.1 [RQ.SRS-026.ClickHouseOperator.Deployments.MultipleStorageVolumes](#rqsrs-026clickhouseoperatordeploymentsmultiplestoragevolumes)
  * 4.17 [Plugging External Volumes](#plugging-external-volumes)
    * 4.17.1 [RQ.SRS-026.ClickHouseOperator.Deployments.PluggingExternalVolumes](#rqsrs-026clickhouseoperatordeploymentspluggingexternalvolumes)
  * 4.18 [Configuration File Control](#configuration-file-control)
    * 4.18.1 [YAML Syntax For `config.xml`](#yaml-syntax-for-configxml)
      * 4.18.1.1 [RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.ConfigXML](#rqsrs-026clickhouseoperatorconfigurationfilecontrolconfigxml)
    * 4.18.2 [YAML Syntax For `users.xml`](#yaml-syntax-for-usersxml)
      * 4.18.2.1 [RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.UsersXML](#rqsrs-026clickhouseoperatorconfigurationfilecontrolusersxml)
    * 4.18.3 [Embedded XML Files](#embedded-xml-files)
      * 4.18.3.1 [RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.EmbeddedXML](#rqsrs-026clickhouseoperatorconfigurationfilecontrolembeddedxml)
    * 4.18.4 [Macros XML](#macros-xml)
      * 4.18.4.1 [RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.MacrosXML](#rqsrs-026clickhouseoperatorconfigurationfilecontrolmacrosxml)
  * 4.19 [Retaining Volume Claim Templates](#retaining-volume-claim-templates)
    * 4.19.1 [RQ.SRS-026.ClickHouseOperator.RetainingVolumeClaimTemplates](#rqsrs-026clickhouseoperatorretainingvolumeclaimtemplates)
  * 4.20 [Reconnecting Existing Persistent Volumes](#reconnecting-existing-persistent-volumes)
    * 4.20.1 [RQ.SRS-026.ClickHouseOperator.ReconnectingExistingPersistentVolumes](#rqsrs-026clickhouseoperatorreconnectingexistingpersistentvolumes)
  * 4.21 [Maintaining Cluster Uptime During Changes](#maintaining-cluster-uptime-during-changes)
    * 4.21.1 [RQ.SRS-026.ClickHouseOperator.MaintainingClusterUpTimeDuringChanges](#rqsrs-026clickhouseoperatormaintainingclusteruptimeduringchanges)
  * 4.22 [Adding New Persistent Volumes To Pods](#adding-new-persistent-volumes-to-pods)
    * 4.22.1 [RQ.SRS-026.ClickHouseOperator.AddingNewPersistentVolumesToPods](#rqsrs-026clickhouseoperatoraddingnewpersistentvolumestopods)
  * 4.23 [Interrupting Application of ClickHouse Cluster Changes](#interrupting-application-of-clickhouse-cluster-changes)
    * 4.23.1 [RQ.SRS-026.ClickHouseOperator.InterruptingApplicationOfClickHouseClusterChanges](#rqsrs-026clickhouseoperatorinterruptingapplicationofclickhouseclusterchanges)
  * 4.24 [Managing ClickHouse](#managing-clickhouse)
    * 4.24.1 [Configuring TLS](#configuring-tls)
      * 4.24.1.1 [RQ.SRS-026.ClickHouseOperator.Managing.TLS](#rqsrs-026clickhouseoperatormanagingtls)
    * 4.24.2 [Restarting ZooKeeper Cluster](#restarting-zookeeper-cluster)
      * 4.24.2.1 [RQ.SRS-026.ClickHouseOperator.Managing.RestartingZooKeeper](#rqsrs-026clickhouseoperatormanagingrestartingzookeeper)
    * 4.24.3 [Application of Changes](#application-of-changes)
      * 4.24.3.1 [RQ.SRS-026.ClickHouseOperator.Managing.Changes](#rqsrs-026clickhouseoperatormanagingchanges)
    * 4.24.4 [Rollback On Error](#rollback-on-error)
      * 4.24.4.1 [RQ.SRS-026.ClickHouseOperator.Managing.RollbackOnError](#rqsrs-026clickhouseoperatormanagingrollbackonerror)
    * 4.24.5 [Changes Requiring Restart](#changes-requiring-restart)
      * 4.24.5.1 [RQ.SRS-026.ClickHouseOperator.Managing.ChangesRequiringRestart](#rqsrs-026clickhouseoperatormanagingchangesrequiringrestart)
    * 4.24.6 [Configuration And Settings](#configuration-and-settings)
      * 4.24.6.1 [RQ.SRS-026.ClickHouseOperator.Managing.ConfigurationAndSettings](#rqsrs-026clickhouseoperatormanagingconfigurationandsettings)
    * 4.24.7 [Cluster Scaling](#cluster-scaling)
      * 4.24.7.1 [Adding Shards](#adding-shards)
        * 4.24.7.1.1 [RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.AddingShards](#rqsrs-026clickhouseoperatormanagingclusterscalingaddingshards)
      * 4.24.7.2 [Adding Replicas](#adding-replicas)
        * 4.24.7.2.1 [RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.AddingReplicas](#rqsrs-026clickhouseoperatormanagingclusterscalingaddingreplicas)
      * 4.24.7.3 [Adding Replication To Existing Non-replicated Cluster](#adding-replication-to-existing-non-replicated-cluster)
        * 4.24.7.3.1 [RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.AddingReplicationToExistingNonReplicatedCluster](#rqsrs-026clickhouseoperatormanagingclusterscalingaddingreplicationtoexistingnonreplicatedcluster)
      * 4.24.7.4 [Schema Propagation](#schema-propagation)
        * 4.24.7.4.1 [RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.SchemaPropagation](#rqsrs-026clickhouseoperatormanagingclusterscalingschemapropagation)
      * 4.24.7.5 [Scaling Down](#scaling-down)
        * 4.24.7.5.1 [RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.Down](#rqsrs-026clickhouseoperatormanagingclusterscalingdown)
    * 4.24.8 [ClickHouse Version Upgrades](#clickhouse-version-upgrades)
      * 4.24.8.1 [RQ.SRS-026.ClickHouseOperator.Managing.VersionUpgrades](#rqsrs-026clickhouseoperatormanagingversionupgrades)
      * 4.24.8.2 [RQ.SRS-026.ClickHouseOperator.Managing.VersionUpgrades.IndividualOrAll](#rqsrs-026clickhouseoperatormanagingversionupgradesindividualorall)
    * 4.24.9 [Re-provisioning Pods Using Different Template](#re-provisioning-pods-using-different-template)
      * 4.24.9.1 [RQ.SRS-026.ClickHouseOperator.Managing.ReprovisioningPodsUsingDifferentTemplate](#rqsrs-026clickhouseoperatormanagingreprovisioningpodsusingdifferenttemplate)
    * 4.24.10 [Re-provisioning Volume](#re-provisioning-volume)
      * 4.24.10.1 [RQ.SRS-026.ClickHouseOperator.Managing.ReprovisioningVolume](#rqsrs-026clickhouseoperatormanagingreprovisioningvolume)
    * 4.24.11 [Stopping And Starting](#stopping-and-starting)
      * 4.24.11.1 [RQ.SRS-026.ClickHouseOperator.Managing.StoppingAndStarting](#rqsrs-026clickhouseoperatormanagingstoppingandstarting)
    * 4.24.12 [Stopping Specific ClickHouse Pods](#stopping-specific-clickhouse-pods)
      * 4.24.12.1 [RQ.SRS-026.ClickHouseOperator.Managing.StoppingSpecificClickHousePods](#rqsrs-026clickhouseoperatormanagingstoppingspecificclickhousepods)
    * 4.24.13 [Stopping Specific ClickHouse Hosts](#stopping-specific-clickhouse-hosts)
      * 4.24.13.1 [RQ.SRS-026.ClickHouseOperator.Managing.StoppingSpecificClickHouseHosts](#rqsrs-026clickhouseoperatormanagingstoppingspecificclickhousehosts)
    * 4.24.14 [Exporting Metrics](#exporting-metrics)
      * 4.24.14.1 [RQ.SRS-026.ClickHouseOperator.Managing.ExportingMetrics](#rqsrs-026clickhouseoperatormanagingexportingmetrics)
    * 4.24.15 [Monitoring](#monitoring)
      * 4.24.15.1 [RQ.SRS-026.ClickHouseOperator.Managing.Monitoring](#rqsrs-026clickhouseoperatormanagingmonitoring)
    * 4.24.16 [Rolling Update](#rolling-update)
      * 4.24.16.1 [RQ.SRS-026.ClickHouseOperator.Managing.RollingUpdate](#rqsrs-026clickhouseoperatormanagingrollingupdate)
  * 4.25 [Logging](#logging)
      * 4.25.16.1 [RQ.SRS-026.ClickHouseOperator.Logging](#rqsrs-026clickhouseoperatorlogging)
      * 4.25.16.2 [High Level Status](#high-level-status)
        * 4.25.16.2.1 [RQ.SRS-026.ClickHouseOperator.Logging.HighLevelStatus](#rqsrs-026clickhouseoperatorlogginghighlevelstatus)
  * 4.26 [Valid Installation](#valid-installation)
    * 4.26.1 [RQ.SRS-026.ClickHouseOperator.ValidInstallation](#rqsrs-026clickhouseoperatorvalidinstallation)
  * 4.27 [Operator Settings](#operator-settings)
    * 4.27.1 [config.yaml](#configyaml)
      * 4.27.1.1 [RQ.SRS-026.ClickHouseOperator.Settings.ConfigYaml](#rqsrs-026clickhouseoperatorsettingsconfigyaml)
    * 4.27.2 [Config Map](#config-map)
      * 4.27.2.1 [RQ.SRS-026.ClickHouseOperator.Settings.ConfigMap](#rqsrs-026clickhouseoperatorsettingsconfigmap)
      * 4.27.2.2 [RQ.SRS-026.ClickHouseOperator.Settings.ConfigMap.Changes](#rqsrs-026clickhouseoperatorsettingsconfigmapchanges)
    * 4.27.3 [`ClickHouseOperatorConfiguration` Resource](#clickhouseoperatorconfiguration-resource)
      * 4.27.3.1 [RQ.SRS-026.ClickHouseOperator.Settings.ClickHouseOperatorConfiguration](#rqsrs-026clickhouseoperatorsettingsclickhouseoperatorconfiguration)
      * 4.27.3.2 [RQ.SRS-026.ClickHouseOperator.Settings.ClickHouseOperatorConfiguration.Changes](#rqsrs-026clickhouseoperatorsettingsclickhouseoperatorconfigurationchanges)
  * 4.28 [ClickHouse Config Maps](#clickhouse-config-maps)
    * 4.28.1 [RQ.SRS-026.ClickHouseOperator.ClickHouse.ConfigMaps](#rqsrs-026clickhouseoperatorclickhouseconfigmaps)
  * 4.29 [ClickHouse Config Maps Defaults](#clickhouse-config-maps-defaults)
    * 4.29.1 [RQ.SRS-026.ClickHouseOperator.ClickHouse.ConfigMaps.Defaults](#rqsrs-026clickhouseoperatorclickhouseconfigmapsdefaults)
  * 4.30 [Custom Resource Definition](#custom-resource-definition)
    * 4.30.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.CustomResourceDefinition](#rqsrs-026clickhouseoperatorcustomresourcecustomresourcedefinition)
  * 4.31 [API Version](#api-version)
    * 4.31.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.APIVersion](#rqsrs-026clickhouseoperatorcustomresourceapiversion)
  * 4.32 [Resource Kind](#resource-kind)
    * 4.32.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Kind.ClickHouseInstallation](#rqsrs-026clickhouseoperatorcustomresourcekindclickhouseinstallation)
    * 4.32.2 [RQ.SRS-026.ClickHouseOperator.CustomResource.Kind.ClickHouseInstallationTemplate](#rqsrs-026clickhouseoperatorcustomresourcekindclickhouseinstallationtemplate)
    * 4.32.3 [RQ.SRS-026.ClickHouseOperator.CustomResource.Kind.ClickHouseOperatorConfiguration](#rqsrs-026clickhouseoperatorcustomresourcekindclickhouseoperatorconfiguration)
  * 4.33 [Metadata](#metadata)
    * 4.33.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Metadata](#rqsrs-026clickhouseoperatorcustomresourcemetadata)
  * 4.34 [Cluster Specification](#cluster-specification)
    * 4.34.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec](#rqsrs-026clickhouseoperatorcustomresourcespec)
  * 4.35 [Task Identifier](#task-identifier)
    * 4.35.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.TaskID](#rqsrs-026clickhouseoperatorcustomresourcespectaskid)
  * 4.36 [Stopping ClickHouse Clusters](#stopping-clickhouse-clusters)
    * 4.36.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Stop](#rqsrs-026clickhouseoperatorcustomresourcespecstop)
  * 4.37 [Restart Policy For StatefulSets](#restart-policy-for-statefulsets)
    * 4.37.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Restart](#rqsrs-026clickhouseoperatorcustomresourcespecrestart)
  * 4.38 [Troubleshooting Pods](#troubleshooting-pods)
    * 4.38.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Troubleshoot](#rqsrs-026clickhouseoperatorcustomresourcespectroubleshoot)
  * 4.39 [Custom Domain Suffix](#custom-domain-suffix)
    * 4.39.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.NamespaceDomainPattern](#rqsrs-026clickhouseoperatorcustomresourcespecnamespacedomainpattern)
  * 4.40 [Policy For Auto Applying Templates](#policy-for-auto-applying-templates)
    * 4.40.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templating](#rqsrs-026clickhouseoperatorcustomresourcespectemplating)
  * 4.41 [Reconciling Cycle](#reconciling-cycle)
    * 4.41.1 [RQ.SRS-026.ClickHouseOperator.ReconcilingCycle](#rqsrs-026clickhouseoperatorreconcilingcycle)
    * 4.41.2 [Applying ConfigMaps Before StatefulSets](#applying-configmaps-before-statefulsets)
      * 4.41.2.1 [RQ.SRS-026.ClickHouseOperator.ReconcilingCycle.ApplyingConfigMapsBeforeStatefulSets](#rqsrs-026clickhouseoperatorreconcilingcycleapplyingconfigmapsbeforestatefulsets)
    * 4.41.3 [Configuring Reconciling Cycle](#configuring-reconciling-cycle)
      * 4.41.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling](#rqsrs-026clickhouseoperatorcustomresourcespecreconciling)
    * 4.41.4 [Reconciliation Policy Name](#reconciliation-policy-name)
      * 4.41.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Policy](#rqsrs-026clickhouseoperatorcustomresourcespecreconcilingpolicy)
    * 4.41.5 [ConfigMap Propagation Timeout](#configmap-propagation-timeout)
      * 4.41.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.ConfigMapPropagationTimeout](#rqsrs-026clickhouseoperatorcustomresourcespecreconcilingconfigmappropagationtimeout)
    * 4.41.6 [Cleaning Objects](#cleaning-objects)
      * 4.41.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Cleanup](#rqsrs-026clickhouseoperatorcustomresourcespecreconcilingcleanup)
    * 4.41.7 [Cleaning Up Unknown Objects](#cleaning-up-unknown-objects)
      * 4.41.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Cleanup.UnknownObjects](#rqsrs-026clickhouseoperatorcustomresourcespecreconcilingcleanupunknownobjects)
    * 4.41.8 [Reconciling Failed Objects](#reconciling-failed-objects)
      * 4.41.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Cleanup.ReconcileFailedObjects](#rqsrs-026clickhouseoperatorcustomresourcespecreconcilingcleanupreconcilefailedobjects)
  * 4.42 [Defaults](#defaults)
      * 4.42.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults](#rqsrs-026clickhouseoperatorcustomresourcespecdefaults)
    * 4.42.9 [Specifying Replicas By FQDN](#specifying-replicas-by-fqdn)
      * 4.42.9.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.ReplicasUseFQDN](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultsreplicasusefqdn)
    * 4.42.10 [Changing Distributed_DDL Settings](#changing-distributed_ddl-settings)
      * 4.42.10.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.DistributedDDL](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultsdistributedddl)
    * 4.42.11 [Templates](#templates)
      * 4.42.11.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplates)
      * 4.42.11.2 [Host Template](#host-template)
        * 4.42.11.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.HostTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplateshosttemplate)
      * 4.42.11.3 [Pod Template](#pod-template)
        * 4.42.11.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.PodTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatespodtemplate)
      * 4.42.11.4 [Data Volume Claim Template](#data-volume-claim-template)
        * 4.42.11.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.dataVolumeClaimTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatesdatavolumeclaimtemplate)
      * 4.42.11.5 [Log Volume Claim Template](#log-volume-claim-template)
        * 4.42.11.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.logVolumeClaimTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplateslogvolumeclaimtemplate)
      * 4.42.11.6 [Service Template](#service-template)
        * 4.42.11.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ServiceTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatesservicetemplate)
      * 4.42.11.7 [Cluster Service Template](#cluster-service-template)
        * 4.42.11.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ClusterServiceTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatesclusterservicetemplate)
      * 4.42.11.8 [Shard Service Template](#shard-service-template)
        * 4.42.11.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ShardServiceTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatesshardservicetemplate)
      * 4.42.11.9 [Replica Service Template](#replica-service-template)
        * 4.42.11.9.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ReplicaServiceTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatesreplicaservicetemplate)
      * 4.42.11.10 [Volume Claim Template](#volume-claim-template)
        * 4.42.11.10.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.VolumeClaimTemplate](#rqsrs-026clickhouseoperatorcustomresourcespecdefaultstemplatesvolumeclaimtemplate)
  * 4.43 [ClickHouse Server Configuration](#clickhouse-server-configuration)
    * 4.43.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration](#rqsrs-026clickhouseoperatorcustomresourcespecconfiguration)
    * 4.43.2 [ZooKeeper](#zookeeper)
      * 4.43.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationzookeeper)
      * 4.43.2.2 [ZooKeeper Nodes](#zookeeper-nodes)
        * 4.43.2.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.Nodes](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationzookeepernodes)
      * 4.43.2.3 [Session Timeout](#session-timeout)
        * 4.43.2.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.SessionTimeoutMs](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationzookeepersessiontimeoutms)
      * 4.43.2.4 [Operation Timeout](#operation-timeout)
        * 4.43.2.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.OperationTimeoutMs](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationzookeeperoperationtimeoutms)
      * 4.43.2.5 [Root Path](#root-path)
        * 4.43.2.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.Root](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationzookeeperroot)
      * 4.43.2.6 [Login Credentials](#login-credentials)
        * 4.43.2.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.Identify](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationzookeeperidentify)
    * 4.43.3 [Users](#users)
      * 4.43.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Users](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationusers)
    * 4.43.4 [Profiles](#profiles)
      * 4.43.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Profiles](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationprofiles)
    * 4.43.5 [Quotas](#quotas)
      * 4.43.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Quotas](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationquotas)
    * 4.43.6 [Settings](#settings)
      * 4.43.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Settings](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationsettings)
    * 4.43.7 [Files](#files)
      * 4.43.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Files](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationfiles)
  * 4.44 [ClickHouse Clusters Configuration](#clickhouse-clusters-configuration)
    * 4.44.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclusters)
    * 4.44.2 [Cluster Name](#cluster-name)
      * 4.44.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Name](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclustername)
    * 4.44.3 [Cluster ZooKeeper](#cluster-zookeeper)
      * 4.44.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.ZooKeeper](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterzookeeper)
    * 4.44.4 [Cluster Settings](#cluster-settings)
      * 4.44.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Settings](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclustersettings)
    * 4.44.5 [Cluster Files](#cluster-files)
      * 4.44.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Files](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterfiles)
    * 4.44.6 [Cluster Templates](#cluster-templates)
      * 4.44.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Templates](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclustertemplates)
  * 4.45 [ClickHouse Cluster Layout](#clickhouse-cluster-layout)
    * 4.45.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayout)
    * 4.45.2 [Layout Type (Deprecated)](#layout-type-deprecated)
      * 4.45.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Type](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayouttype)
    * 4.45.3 [Layout Shards Count](#layout-shards-count)
      * 4.45.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.ShardsCount](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardscount)
    * 4.45.4 [Layout Replicas Count](#layout-replicas-count)
      * 4.45.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.ReplicasCount](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicascount)
    * 4.45.5 [Layout Shards](#layout-shards)
      * 4.45.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshards)
      * 4.45.5.2 [Shard Name](#shard-name)
        * 4.45.5.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Name](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsname)
      * 4.45.5.3 [Shard Definition Type (Deprecated)](#shard-definition-type-deprecated)
        * 4.45.5.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.DefinitionType](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsdefinitiontype)
      * 4.45.5.4 [Shard Weight](#shard-weight)
        * 4.45.5.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Weight](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsweight)
      * 4.45.5.5 [Shard Internnal Replication](#shard-internnal-replication)
        * 4.45.5.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.InternalReplication](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsinternalreplication)
      * 4.45.5.6 [Shard Settings](#shard-settings)
        * 4.45.5.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Settings](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardssettings)
      * 4.45.5.7 [Shard Files](#shard-files)
        * 4.45.5.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Files](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsfiles)
      * 4.45.5.8 [Shard Templates](#shard-templates)
        * 4.45.5.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Templates](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardstemplates)
      * 4.45.5.9 [Shard Replicas Count](#shard-replicas-count)
        * 4.45.5.9.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.ReplicasCount](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicascount)
    * 4.45.6 [Layout Shards Replicas](#layout-shards-replicas)
      * 4.45.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicas)
      * 4.45.6.2 [Shard Replica Name](#shard-replica-name)
        * 4.45.6.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Name](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicasname)
      * 4.45.6.3 [Shard Replica TCP Port](#shard-replica-tcp-port)
        * 4.45.6.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.TcpPort](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicastcpport)
      * 4.45.6.4 [Shard Replica HTTP Port](#shard-replica-http-port)
        * 4.45.6.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.HttpPort](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicashttpport)
      * 4.45.6.5 [Shard Replica Inter-server HTTP Port](#shard-replica-inter-server-http-port)
        * 4.45.6.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.InterServerHttpPort](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicasinterserverhttpport)
      * 4.45.6.6 [Shard Replica Settings](#shard-replica-settings)
        * 4.45.6.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Settings](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicassettings)
      * 4.45.6.7 [Shard Replica Files](#shard-replica-files)
        * 4.45.6.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Files](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicasfiles)
      * 4.45.6.8 [Shard Replica Templates](#shard-replica-templates)
        * 4.45.6.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Templates](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutshardsreplicastemplates)
    * 4.45.7 [Layout Replicas](#layout-replicas)
      * 4.45.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicas)
      * 4.45.7.2 [Replica Name](#replica-name)
        * 4.45.7.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Name](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasname)
      * 4.45.7.3 [Replica Settings](#replica-settings)
        * 4.45.7.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Settings](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicassettings)
      * 4.45.7.4 [Replica Files](#replica-files)
        * 4.45.7.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Files](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasfiles)
      * 4.45.7.5 [Replica Templates](#replica-templates)
        * 4.45.7.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Templates](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicastemplates)
      * 4.45.7.6 [Replica Shards Count](#replica-shards-count)
        * 4.45.7.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.ShardsCount](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardscount)
    * 4.45.8 [Layout Replicas Shards](#layout-replicas-shards)
      * 4.45.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshards)
      * 4.45.8.2 [Replica Shard Name](#replica-shard-name)
        * 4.45.8.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Name](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardsname)
      * 4.45.8.3 [Replica Shard TCP Port](#replica-shard-tcp-port)
        * 4.45.8.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.TcpPort](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardstcpport)
      * 4.45.8.4 [Replica Shard HTTP Port](#replica-shard-http-port)
        * 4.45.8.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.HttpPort](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardshttpport)
      * 4.45.8.5 [Replica Shard Inter-server HTTP Port](#replica-shard-inter-server-http-port)
        * 4.45.8.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.InterServerHttpPort](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardsinterserverhttpport)
      * 4.45.8.6 [Replica Shard Settings](#replica-shard-settings)
        * 4.45.8.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Settings](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardssettings)
      * 4.45.8.7 [Replica Shard Files](#replica-shard-files)
        * 4.45.8.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Files](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardsfiles)
      * 4.45.8.8 [Replica Shard Templates](#replica-shard-templates)
        * 4.45.8.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Templates](#rqsrs-026clickhouseoperatorcustomresourcespecconfigurationclustersclusterlayoutreplicasshardstemplates)
  * 4.46 [User Defined Templates](#user-defined-templates)
    * 4.46.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates](#rqsrs-026clickhouseoperatorcustomresourcespectemplates)
  * 4.47 [Host Templates](#host-templates)
    * 4.47.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplates)
    * 4.47.2 [Host Template Name](#host-template-name)
      * 4.47.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Name](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesname)
    * 4.47.3 [Host Template Port Distribution](#host-template-port-distribution)
      * 4.47.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.PortDistribution](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesportdistribution)
      * 4.47.3.2 [Port Distribution Type](#port-distribution-type)
        * 4.47.3.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.PortDistribution.Type](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesportdistributiontype)
    * 4.47.4 [Host Template Specification](#host-template-specification)
      * 4.47.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspec)
      * 4.47.4.2 [Host Name](#host-name)
        * 4.47.4.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Name](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspecname)
      * 4.47.4.3 [Host TCP Port](#host-tcp-port)
        * 4.47.4.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.TcpPort](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspectcpport)
      * 4.47.4.4 [Host HTTP Port](#host-http-port)
        * 4.47.4.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.HttpPort](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspechttpport)
      * 4.47.4.5 [Host Inter-server HTTP Port](#host-inter-server-http-port)
        * 4.47.4.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.InterServerHttpPort](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspecinterserverhttpport)
      * 4.47.4.6 [Host Settings](#host-settings)
        * 4.47.4.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Settings](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspecsettings)
      * 4.47.4.7 [Host Files](#host-files)
        * 4.47.4.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Files](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspecfiles)
      * 4.47.4.8 [Host Overriding Templates](#host-overriding-templates)
        * 4.47.4.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Templates](#rqsrs-026clickhouseoperatorcustomresourcespectemplateshosttemplatesspectemplates)
  * 4.48 [Pod Templates](#pod-templates)
    * 4.48.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplates)
    * 4.48.2 [Pod Name](#pod-name)
      * 4.48.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Name](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatesname)
    * 4.48.3 [Pod Generate Name](#pod-generate-name)
      * 4.48.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.GenerateName](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatesgeneratename)
    * 4.48.4 [Pod Zone](#pod-zone)
      * 4.48.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Zone](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplateszone)
      * 4.48.4.2 [Pod Zone Key](#pod-zone-key)
        * 4.48.4.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Zone.Key](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplateszonekey)
      * 4.48.4.3 [Pod Zone Values](#pod-zone-values)
        * 4.48.4.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Zone.Values](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplateszonevalues)
    * 4.48.5 [Pod Distribution](#pod-distribution)
      * 4.48.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatespoddistribution)
      * 4.48.5.2 [Pod Distribution Type](#pod-distribution-type)
        * 4.48.5.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.Type](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatespoddistributiontype)
      * 4.48.5.3 [Pod Distribution Scope](#pod-distribution-scope)
        * 4.48.5.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.Scope](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatespoddistributionscope)
      * 4.48.5.4 [Pod Distribution Number](#pod-distribution-number)
        * 4.48.5.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.Number](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatespoddistributionnumber)
      * 4.48.5.5 [Pod Distribution Topology Key](#pod-distribution-topology-key)
        * 4.48.5.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.TopologyKey](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatespoddistributiontopologykey)
    * 4.48.6 [Pod Spec](#pod-spec)
      * 4.48.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Spec](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatesspec)
    * 4.48.7 [Pod Metadata](#pod-metadata)
      * 4.48.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Metadata](#rqsrs-026clickhouseoperatorcustomresourcespectemplatespodtemplatesmetadata)
  * 4.49 [Volume Claim Templates](#volume-claim-templates)
    * 4.49.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesvolumeclaimtemplates)
    * 4.49.2 [Volume Claim Name](#volume-claim-name)
      * 4.49.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.Name](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesvolumeclaimtemplatesname)
    * 4.49.3 [Volume Claim Reclaim Policy](#volume-claim-reclaim-policy)
      * 4.49.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.ReclaimPolicy](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesvolumeclaimtemplatesreclaimpolicy)
    * 4.49.4 [Volume Claim Metadata](#volume-claim-metadata)
      * 4.49.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.Metadata](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesvolumeclaimtemplatesmetadata)
    * 4.49.5 [Volume Claim Spec](#volume-claim-spec)
      * 4.49.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.Spec](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesvolumeclaimtemplatesspec)
  * 4.50 [Service Templates](#service-templates)
    * 4.50.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesservicetemplates)
    * 4.50.2 [Service Name](#service-name)
      * 4.50.2.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.Name](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesservicetemplatesname)
    * 4.50.3 [Service Generate Name](#service-generate-name)
      * 4.50.3.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.GenerateName](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesservicetemplatesgeneratename)
    * 4.50.4 [Service Generate Metadata](#service-generate-metadata)
      * 4.50.4.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.Metadata](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesservicetemplatesmetadata)
    * 4.50.5 [Service Spec](#service-spec)
      * 4.50.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.Spec](#rqsrs-026clickhouseoperatorcustomresourcespectemplatesservicetemplatesspec)
  * 4.51 [Use Templates](#use-templates)
      * 4.51.5.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates](#rqsrs-026clickhouseoperatorcustomresourcespecusetemplates)
    * 4.51.6 [Use Template Name](#use-template-name)
      * 4.51.6.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates.Name](#rqsrs-026clickhouseoperatorcustomresourcespecusetemplatesname)
    * 4.51.7 [Use Template Namespace](#use-template-namespace)
      * 4.51.7.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates.Namespace](#rqsrs-026clickhouseoperatorcustomresourcespecusetemplatesnamespace)
    * 4.51.8 [Use Template Use Type](#use-template-use-type)
      * 4.51.8.1 [RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates.UseType](#rqsrs-026clickhouseoperatorcustomresourcespecusetemplatesusetype)
  * 4.52 [ClickHouse Operator Configuration](#clickhouse-operator-configuration)
    * 4.52.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec](#rqsrs-026clickhouseoperatorconfigurationspec)
    * 4.52.2 [Watched Namespaces](#watched-namespaces)
      * 4.52.2.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.WatchNamespaces](#rqsrs-026clickhouseoperatorconfigurationspecwatchnamespaces)
    * 4.52.3 [ClickHouse Common Configs Path](#clickhouse-common-configs-path)
      * 4.52.3.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseCommonConfigsPath](#rqsrs-026clickhouseoperatorconfigurationspecclickhousecommonconfigspath)
    * 4.52.4 [ClickHouse Host Configs Path](#clickhouse-host-configs-path)
      * 4.52.4.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseHostConfigsPath](#rqsrs-026clickhouseoperatorconfigurationspecclickhousehostconfigspath)
    * 4.52.5 [ClickHouse Users Configs Path](#clickhouse-users-configs-path)
      * 4.52.5.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseUsersConfigsPath](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseusersconfigspath)
    * 4.52.6 [Templates Path](#templates-path)
      * 4.52.6.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.TemplatesPath](#rqsrs-026clickhouseoperatorconfigurationspectemplatespath)
    * 4.52.7 [StatefulSet Update Timeout](#statefulset-update-timeout)
      * 4.52.7.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetUpdateTimeout](#rqsrs-026clickhouseoperatorconfigurationspecstatefulsetupdatetimeout)
    * 4.52.8 [StatefulSet Update Poll Period](#statefulset-update-poll-period)
      * 4.52.8.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetUpdatePollPeriod](#rqsrs-026clickhouseoperatorconfigurationspecstatefulsetupdatepollperiod)
    * 4.52.9 [StatefulSet Create Failure Action](#statefulset-create-failure-action)
      * 4.52.9.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetCreateFailureAction](#rqsrs-026clickhouseoperatorconfigurationspecstatefulsetcreatefailureaction)
    * 4.52.10 [StatefulSet Update Failure Action](#statefulset-update-failure-action)
      * 4.52.10.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetUpdateFailureAction](#rqsrs-026clickhouseoperatorconfigurationspecstatefulsetupdatefailureaction)
    * 4.52.11 [ClickHouse Config User Default Profile](#clickhouse-config-user-default-profile)
      * 4.52.11.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultProfile](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseconfiguserdefaultprofile)
    * 4.52.12 [ClickHouse Config User Default Quota](#clickhouse-config-user-default-quota)
      * 4.52.12.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultQuota](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseconfiguserdefaultquota)
    * 4.52.13 [ClickHouse Config User Default Networks IP](#clickhouse-config-user-default-networks-ip)
      * 4.52.13.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultNetworksIP](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseconfiguserdefaultnetworksip)
    * 4.52.14 [ClickHouse Config User Default Password](#clickhouse-config-user-default-password)
      * 4.52.14.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultPassword](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseconfiguserdefaultpassword)
    * 4.52.15 [ClickHouse Config Networks Host Regexp Template](#clickhouse-config-networks-host-regexp-template)
      * 4.52.15.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigNetworksHostRegexpTemplate](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseconfignetworkshostregexptemplate)
    * 4.52.16 [ClickHouse Credentials Secret Namespace](#clickhouse-credentials-secret-namespace)
      * 4.52.16.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseCredentialsSecretNamespace](#rqsrs-026clickhouseoperatorconfigurationspecclickhousecredentialssecretnamespace)
    * 4.52.17 [ClickHouse Credentials Secret Name](#clickhouse-credentials-secret-name)
      * 4.52.17.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseCredentialsSecretName](#rqsrs-026clickhouseoperatorconfigurationspecclickhousecredentialssecretname)
    * 4.52.18 [ClickHouse Port](#clickhouse-port)
      * 4.52.18.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHousePort](#rqsrs-026clickhouseoperatorconfigurationspecclickhouseport)
    * 4.52.19 [Log To `stderr`](#log-to-stderr)
      * 4.52.19.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.LogToStderr](#rqsrs-026clickhouseoperatorconfigurationspeclogtostderr)
    * 4.52.20 [Log To `stderr` And Files](#log-to-stderr-and-files)
      * 4.52.20.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.AlsoLogToStderr](#rqsrs-026clickhouseoperatorconfigurationspecalsologtostderr)
    * 4.52.21 [Verbosity Level](#verbosity-level)
      * 4.52.21.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.VerbosityLevel](#rqsrs-026clickhouseoperatorconfigurationspecverbositylevel)
    * 4.52.22 [Threshold For `stderr`](#threshold-for-stderr)
      * 4.52.22.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StderrThreshold](#rqsrs-026clickhouseoperatorconfigurationspecstderrthreshold)
    * 4.52.23 [V Module](#v-module)
      * 4.52.23.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.VModule](#rqsrs-026clickhouseoperatorconfigurationspecvmodule)
    * 4.52.24 [Logging Backtrace](#logging-backtrace)
      * 4.52.24.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.LogBacktrace](#rqsrs-026clickhouseoperatorconfigurationspeclogbacktrace)
    * 4.52.25 [Number Of Threads For Reconciliation Cycle](#number-of-threads-for-reconciliation-cycle)
      * 4.52.25.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ReconcileThreadsNumber](#rqsrs-026clickhouseoperatorconfigurationspecreconcilethreadsnumber)
    * 4.52.26 [Wait Exclude For Reconciliation Cycle](#wait-exclude-for-reconciliation-cycle)
      * 4.52.26.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ReconcileWaitExclude](#rqsrs-026clickhouseoperatorconfigurationspecreconcilewaitexclude)
    * 4.52.27 [Wait Include For Reconciliation Cycle](#wait-include-for-reconciliation-cycle)
      * 4.52.27.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ReconcileWaitInclude](#rqsrs-026clickhouseoperatorconfigurationspecreconcilewaitinclude)
    * 4.52.28 [Excluding From Propagation Labels](#excluding-from-propagation-labels)
      * 4.52.28.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ExcludeFromPropagationLabels](#rqsrs-026clickhouseoperatorconfigurationspecexcludefrompropagationlabels)
    * 4.52.29 [Appending Scope Labels](#appending-scope-labels)
      * 4.52.29.1 [RQ.SRS-026.ClickHouseOperator.Configuration.Spec.AppendScopeLabels](#rqsrs-026clickhouseoperatorconfigurationspecappendscopelabels)
  * 4.53 [Stateful Sets](#stateful-sets)
    * 4.53.1 [RQ.SRS-026.ClickHouseOperator.StatefulSets](#rqsrs-026clickhouseoperatorstatefulsets)
    * 4.53.2 [Sticky Identity](#sticky-identity)
      * 4.53.2.1 [RQ.SRS-026.ClickHouseOperator.StatefulSets.PodsStickyIdentity](#rqsrs-026clickhouseoperatorstatefulsetspodsstickyidentity)
    * 4.53.3 [Pods Created From The Same Spec](#pods-created-from-the-same-spec)
      * 4.53.3.1 [RQ.SRS-026.ClickHouseOperator.StatefulSets.PodsCreatedFromTheSameSpec](#rqsrs-026clickhouseoperatorstatefulsetspodscreatedfromthesamespec)
  * 4.54 [Error Handling](#error-handling)
    * 4.54.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling](#rqsrs-026clickhouseoperatorerrorhandling)
    * 4.54.2 [Health Monitoring](#health-monitoring)
      * 4.54.2.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.HealthMonitoring](#rqsrs-026clickhouseoperatorerrorhandlinghealthmonitoring)
    * 4.54.3 [Polling For Ready](#polling-for-ready)
      * 4.54.3.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.PollingForReady](#rqsrs-026clickhouseoperatorerrorhandlingpollingforready)
    * 4.54.4 [Move On Ready](#move-on-ready)
      * 4.54.4.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.MoveOnReady](#rqsrs-026clickhouseoperatorerrorhandlingmoveonready)
    * 4.54.5 [Create Failure](#create-failure)
      * 4.54.5.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.Create](#rqsrs-026clickhouseoperatorerrorhandlingcreate)
    * 4.54.6 [Update Failure](#update-failure)
      * 4.54.6.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.Update](#rqsrs-026clickhouseoperatorerrorhandlingupdate)
    * 4.54.7 [Reverting Back](#reverting-back)
      * 4.54.7.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.Fails.RevertBack.Create](#rqsrs-026clickhouseoperatorerrorhandlingfailsrevertbackcreate)
      * 4.54.7.2 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.Fails.RevertBack.Update](#rqsrs-026clickhouseoperatorerrorhandlingfailsrevertbackupdate)
    * 4.54.8 [Successful Update Before Failed](#successful-update-before-failed)
        * 4.54.8.2.1 [RQ.SRS-026.ClickHouseOperator.ErrorHandling.SuccessfulUpdateBeforeFailed.DoNothing](#rqsrs-026clickhouseoperatorerrorhandlingsuccessfulupdatebeforefaileddonothing)

## Revision History

This document is stored in an electronic form using [Git] source control management software
hosted in a [GitLab Repository]. All the updates are tracked using the [Revision History].

## Introduction

This software requirements specification covers requirements related to [ClickHouse Operator]
that creates, configures and manages [ClickHouse] clusters running on [Kubernetes].

By design each [StatefulSet] produces only one [Pod] and each [Pod] runs only
one container with one `clickhouse-server` process.

The operator watches for any changes to any resource that have either
_ClickHouseInstallation_, _ClickHouseInstallationTemplate_, and
_ClickHouseOperatorConfiguration_ kind and when change is detected the operator launches
a reconciling cycle that creates or updates [Kubernetes] resources.

The operator only creates or updates the following [Kubernetes] resources:

* [StatefulSet]s
  create and update `clickhouse-server` containers
* [Service]s
  provide and manage network endpoints
* [ConfigMap]s
  control configuration files
* [PVC]s
  provide storage

## Definitions

### PV

Persistent volume.

### CSI

Container storage interface.

### Operator

[Altinity]'s [Kubernetes] operator for [ClickHouse] (https://github.com/Altinity/clickhouse-operator).

### Deployment

A deployment is a file that defines a [Pod]'s desired behavior or characteristics.

### Namespace

A namespace provides a mechanism for isolating groups of resources within a single [Kubernetes] cluster.
See https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/.

### OLM

Operator Lifecycle Manager that extends [Kubernetes] to provide a declarative way to install, manage, and upgrade operators
on [Kubernetes] cluster.

### Pod

One or more containers and is the smallest deployable unit of computing that you
can create and manage in [Kubernetes].
See https://kubernetes.io/docs/concepts/workloads/pods/.

### ReplicaSet

One or more [Pod]s that are tied by the create and update cycle.

### Service

Abstraction which allows to join one or more [Pod]s inside [Kubernetes] cluster
under one common DNS (domain name system) name and IP address.
It provides simple load balancing between those [Pod]s that are tied by the [Service]
and serves as an abstract way to expose an application running on a set of [Pods] as a network service
in [Kubernetes]. See https://kubernetes.io/docs/concepts/services-networking/service/.

### PVC

Request for abstract storage from [CSI] that may result in [PV] being mounted
at specific file system path (mount point) inside the [Pod].
See https://kubernetes.io/docs/concepts/storage/persistent-volumes/.

### CHI

Custom resource of `ClickHouseInstallation` kind that describes a [ClickHouse]
cluster inside [Kubernetes].

### Shard

[ClickHouse] cluster shard.

### Replica

[ClickHouse] cluster replica.

### ConfigMap

Allows to specify to define one or more configuration files that can be mounted inside a [Pod].
It is an API object used to store non-confidential data in key-value pairs.
[Pods] can consume [ConfigMaps] as environment variables, command-line arguments,
or as configuration files in a volume.
See https://kubernetes.io/docs/concepts/configuration/configmap/.

### StatefulSet

Combination of one or more [ReplicaSet]s that can be connected to [PVC].
The workload API object used to manage stateful applications. See
https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/.

### `bool enum` Type

Property type having one of the following values

```yml
 enum:
    - ""
    - "0"
    - "1"
    - "False"
    - "false"
    - "True"
    - "true"
    - "No"
    - "no"
    - "Yes"
    - "yes"
    - "Off"
    - "off"
    - "On"
    - "on"
    - "Disable"
    - "disable"
    - "Enable"
    - "enable"
    - "Disabled"
    - "disabled"
    - "Enabled"
    - "enabled"
```

### `string` Type

Type that can contain any string.

### `integer` Type

Type that can contain any integer.

### `array` Type

Type that can contain zero or more items.


## Requirements

### General

##### RQ.SRS-026.ClickHouseOperator
version: 1.0

[ClickHouse Operator] SHALL support creating, configuring and managing [ClickHouse] clusters running on [Kubernetes].

### Installation

#### RQ.SRS-026.ClickHouseOperator.Installation
version: 1.0

[ClickHouse Operator] SHALL support being installed as a [Deployment] or via CoreOS OLM.

#### Monitoring Support

##### RQ.SRS-026.ClickHouseOperator.Installation.MonitoringSupport
version: 1.0

[ClickHouse Operator] SHALL come with additional metrics-exporter container that SHALL be used for monitoring
when [operator] is installed as a [Deployment].

### Namespaces

#### Kube System

##### RQ.SRS-026.ClickHouseOperator.Namespaces.KubeSystem
version: 1.0

[ClickHouse Operator] SHALL support being installed in `kube-system` [Namespace].
This SHALL be the default.

#### User Defined

##### RQ.SRS-026.ClickHouseOperator.Namespaces.UserDefined
version: 1.0

[ClickHouse Operator] SHALL support being installed user defined [Namespace].

#### Cluster Management

##### RQ.SRS-026.ClickHouseOperator.Namespaces.ClusterManagement
version: 1.0

[ClickHouse Operator] SHALL support managing [ClickHouse] clusters inside [Kubernetes] defined by
[CHI] custom resource in all [Namespace]s by default or list of user defined [Namespace]s.

If [Namespace] is not configured, [operator] SHALL manage [CHI] in the [Namespace] where [operator] is installed.

### ACM Compatibility

##### RQ.SRS-026.ClickHouseOperator.ACM
version: 1.0

[ClickHouse Operator] SHALL be able to create a [ClickHouse] cluster based on manifest generated by [Altinity Cloud Manager](https://altinity.com/cloud-database/)

### Creating Clusters

##### RQ.SRS-026.ClickHouseOperator.Create
version: 1.0

[ClickHouse Operator] SHALL support creating [ClickHouse] clusters based on [custom resource definition].

##### RQ.SRS-026.ClickHouseOperator.DeleteBroken
version: 1.0

[ClickHouse Operator] SHALL support be able to delete a [ClickHouse] cluster with broken image.

### Auto-generated ClickHouse Clusters Definitions

#### RQ.SRS-026.ClickHouseOperator.AutoGeneratedClickHouseClusters
version: 1.0

[ClickHouse Operator] SHALL auto-generate the following [ClickHouse] cluster
definitions inside [ClickHouse] `<remote_servers>` configuration:

* `all-sharded` that SHALL include all nodes from all [ClickHouse] clusters inside a [CHI] where each node is its own shard
* `all-replicated` that SHALL include all nodes from all [ClickHouse] clusters inside a [CHI] all replicas are inside the same shard

### Managing Operator

#### Upgrading Operator

##### RQ.SRS-026.ClickHouseOperator.Managing.UpgradingOperator
version: 1.0

[ClickHouse Operator] SHALL support being updated without restarting any [Pod]s.

#### Downgrading Operator

##### RQ.SRS-026.ClickHouseOperator.Managing.DowngradingOperator
version: 1.0

[ClickHouse Operator] SHALL support being downgraded to previous version.


#### Restaring Operator

##### RQ.SRS-026.ClickHouseOperator.Managing.RestartingOperator
version: 1.0

[ClickHouse Operator] SHALL support being restarted without any effect on the operation
of managed [ClickHouse] clusters.

### Security

#### Default Access Control

##### RQ.SRS-026.ClickHouseOperator.DefaultAccessControl
version: 1.0

[ClickHouse Operator] SHALL support by default restriction of access for specific
users to [ClickHouse] cluster to specific IPs.

#### Default Users

##### RQ.SRS-026.ClickHouseOperator.DefaultUsers
version: 1.0

[ClickHouse Operator] SHALL by default support secure default user for inter-cluster communication
only and SHALL require a separte user for external access.

#### Secrets

##### RQ.SRS-026.ClickHouseOperator.Secrets
version: 1.0

[ClickHouse Operator] SHALL support using secrets for sensitive information
such as ClickHouse password by using [Kubernetes] secrets. ClickHouse password can be stored as secret in different forms: as plaintext, as `sha256` sum or as `double sha1` sum.


For example,

```yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: secret-passwords
stringData:
    pwduser1: pwduser1
    pwduser2: e106728c3541ec3694822a29d4b8b5f1f473508adc148fcb58a60c42bcf3234c
    pwduser3: cbe205a7351dd15397bf423957559512bd4be395

---
apiVersion: clickhouse.altinity.com/v1
kind: ClickHouseInstallation
metadata:
  name: chi-with-password-secrets
spec:
  configuration:
    users:
      default/password: default
      # reference to namespace/name/field in the secret containing passwords
      user1/k8s_secret_password: test/test-011-secret/pwduser1
      user2/k8s_secret_password_sha256_hex: test/test-011-secret/pwduser2
      user3/k8s_secret_password_double_sha1_hex: test/test-011-secret/pwduser3
    clusters:
    - name: default
      layout:
        shardsCount: 1
        replicasCount: 1
```

or

```yaml
templates:
  podTemplates:
    - name: pod-with-mounted-secret
      spec:
        containers:
          - name: clickhouse
            env:
              - name: PASSWORD1
                valueFrom:
                  secretKeyRef:
                    name: secret-passwords
                    key: pwduser1
```

#### Secure Connection

##### RQ.SRS-026.ClickHouseOperator.EnableHttps
version: 1.0

[ClickHouse Operator] SHALL support secure `HTTPS` connection with [ClickHouse] server by changing the configuration. Configurations can be updated at run time using a `chopconf` file.

For example,

```yaml
---
apiVersion: "clickhouse.altinity.com/v1"
kind: "ClickHouseOperatorConfiguration"
metadata:
  name: "test-xxx-chopconf"
spec:
  clickhouse:
    access:
      scheme: https
      port: 8443
```

##### RQ.SRS-026.ClickHouseOperator.CHI.ConnectWithHttps
version: 1.0

[ClickHouse] server deployed by [ClickHouse Operator] SHALL support secure `HTTPS` connection from local [ClickHouse] client.

### Default Templates

#### RQ.SRS-026.ClickHouseOperator.DefaultTemplates
version: 1.0

[ClickHouse Operator] SHALL use its own base default templates
for rendering [Kubernetes] resources like [StatefulSet], [ConfigMap], [Service]
and [PVC] which SHALL be overridable by the user using custom resource definition manifests
when not explicitly specified in any way inside a manifest that SHALL result in a workable
cluster that MAY be stateless.

#### RQ.SRS-026.ClickHouseOperator.DefaultTemplates.MergingWithUserDefinedTemplates
version: 1.0

[ClickHouse Operator] SHALL support merging default templates with user defined ones.

### Annotations In Templates

#### RQ.SRS-026.ClickHouseOperator.AnnotationsInTemplates
version: 1.0

[ClickHouse Operator] SHALL support annotations in the following templates:

* hostTemplate
* podTemplate
* dataVolumeClaimTemplate
* logVolumeClaimTemplate
* serviceTemplate
* clusterServiceTemplate
* shardServiceTemplate
* replicaServiceTemplate

Annotations for [CHI] SHALL be propagated to `podTemplates`.

### Custom Pod Templates

##### RQ.SRS-026.ClickHouseOperator.PodTemplates
version: 1.0

[ClickHouse Operator] SHALL support customized [Pod] templates for cluster, shard, replica and [CHI] level.
[Pod] templates SHALL correspond to [Kubernetes] `PodTemplate` standard specification with
two additional properties `distribution` and `zones` to simplify affinity and anti-affinity rules.

Pod templates SHALL support defining the following:

* image reference for particular [ClickHouse] version
* CPU/memory requests
* affinity and anti-affinity rules that are also available as separate shortcuts:
  * `distribution`’ property streamlines OnePerHost semantics
  * `zones` property streamlines multi-AZ deployment (tested with AWS)

### Custom Service Templates

#### RQ.SRS-026.ClickHouseOperator.ServiceTemplates
version: 1.0

[ClickHouse Operator] SHALL support customized service templates for providing
networking endpoints with the following scopes:

* Global ([CHI] level) using `serviceTemplate`
* Cluster using `clusterServiceTemplate`
* Shard using `shardServiceTemplate`
* Replica using `replicaServiceTemplate`
* Host (implicit)

#### Load Balancer

##### RQ.SRS-026.ClickHouseOperator.ServiceTemplates.LoadBalancer
version: 1.0

[ClickHouse Operator] SHALL provide a load balancer for each [Service] entry point.

#### Standard Kubernetes Service Specification

##### RQ.SRS-026.ClickHouseOperator.ServiceTemplates.ServiceSpecificationStandard
version: 1.0

[ClickHouse Operator] SHALL support [Service] templates that SHALL correspond
to standard [Kubernetes] [Service] specification.

#### Annotations

##### RQ.SRS-026.ClickHouseOperator.ServiceTemplates.Annotations
version: 1.0

[ClickHouse Operator] SHALL support annotations that SHALL allow use of external load balancers.

#### Name Generation

##### RQ.SRS-026.ClickHouseOperator.ServiceTemplates.NameGeneration
version: 1.0

[ClickHouse Operator] SHALL allow to generate service names based
on [CHI], cluster, shard or replica names or indices.

### Custom Host Template

##### RQ.SRS-026.ClickHouseOperator.HostTemplates
version: 1.0

[ClickHouse Operator] SHALL support customized host templates for specifying specific parameters
of a specific host such as hostname, ports etc. as well as to define host networking.

### Custom Volume Claim Templates

##### RQ.SRS-026.ClickHouseOperator.VolumeClaimTamplates
version: 1.0

[ClickHouse Operator] SHALL volume claim tamplates of the following types

* log volume claim using `logVolumeClaimTemplate`
* data volume claim using `dataVolumeClaimTemplate`

that SHALL be used for [ClickHouse] data directory and logs respectively.

[CHI] MAY have one or many volume claim templates.
If volume claim template is not defined, default SHALL be used
defined via the default `ClickHouseInstallationTemplate` resource.

Volume claim templates SHALL correspond to [Kubernetes] `PersistentVolumeClaim`
standard specification.

It SHALL be possible to configure one template for entire [CHI],
or template per shard, per replica, or per host.

### Storage Provisioning

##### RQ.SRS-026.ClickHouseOperator.StorageProvisioning
version: 1.0

[ClickHouse Operator] SHALL support customized storage provisioning using `VolumeClaim` templates.

* Mount data
* Mount logs
* Mount multi-volumes which uses ClickHouse storage policy
* Retain policy
* Support different storage classes (Kubernetes concept)
* Support increase disk size
* Support adding new disks

If [Kubernetes] cluster provides encrypted storage the operator SHALL support using it.

### Deployments

#### Single Node Instances

##### RQ.SRS-026.ClickHouseOperator.Deployments.SingleNodeInstances
version: 1.0

[ClickHouse Operator] SHALL support creating and managing single node instance
deployments.

#### Multiple Shards

##### RQ.SRS-026.ClickHouseOperator.Deployments.MultipleShards
version: 1.0

[ClickHouse Operator] SHALL support creating and managing deployments
where [ClickHouse] cluster contains multiple shards.

#### Multiple Replicas

##### RQ.SRS-026.ClickHouseOperator.Deployments.MultipleReplicas
version: 1.0

[ClickHouse Operator] SHALL support creating and managing deployments
where [ClickHouse] cluster contains multiple replicas for non-sharded tables
when external [ZooKeeper] installation is available.

#### Multiple Shards And Replicas

##### RQ.SRS-026.ClickHouseOperator.Deployments.MultipleShardsAndReplicas
version: 1.0

[ClickHouse Operator] SHALL support creating and managing deployments
where [ClickHouse] cluster contains multiple shards and replicas
when external [ZooKeeper] installation is available.

#### Multiple Clusters

##### RQ.SRS-026.ClickHouseOperator.Deployments.MultipleClusters
version: 1.0

[ClickHouse Operator] SHALL support creating and managing multiple
cluster deployments using a single [CHI].

#### Circular Replication

##### RQ.SRS-026.ClickHouseOperator.Deployments.CircularReplication
version: 1.0

[ClickHouse Operator] SHALL support setting up [ClickHouse] clusters
that use circular replication where any given node can server as both
a shard and a replica for another shard.

#### Different ClickHouse Versions On Replicas And Shards

##### RQ.SRS-026.ClickHouseOperator.Deployments.DifferentClickHouseVersionsOnReplicasAndShards
version: 1.0

[ClickHouse Operator] SHALL support deploying different [ClickHouse] server
versions on replicas and shards.

#### Multiple Storage Volumes

##### RQ.SRS-026.ClickHouseOperator.Deployments.MultipleStorageVolumes
version: 1.0

[ClickHouse Operator] SHALL support deployments that use multiple storage volumes
for [ClickHouse] server by defining storage policy definitions in [ClickHouse]
configuration files.

### Plugging External Volumes

#### RQ.SRS-026.ClickHouseOperator.Deployments.PluggingExternalVolumes
version: 1.0

[ClickHouse Operator] SHALL support plugging of externally created volumes to [CHI].

### Configuration File Control

#### YAML Syntax For `config.xml`

##### RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.ConfigXML
version: 1.0

[ClickHouse Operator] SHALL support specifying contents of [ClickHouse] `config.xml`
using YAML syntax.

#### YAML Syntax For `users.xml`

##### RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.UsersXML
version: 1.0

[ClickHouse Operator] SHALL support specifying contents of [ClickHouse] `users.xml`
using YAML syntax.

#### Embedded XML Files

##### RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.EmbeddedXML
version: 1.0

[ClickHouse Operator] SHALL support embedding XML files in YAML configuration.

#### Macros XML

##### RQ.SRS-026.ClickHouseOperator.ConfigurationFileControl.MacrosXML
version: 1.0

[ClickHouse Operator] SHALL support auto-generating [ClickHouse] `macros.xml`
with standard macros that can be used for replicated tables.

### Retaining Volume Claim Templates

#### RQ.SRS-026.ClickHouseOperator.RetainingVolumeClaimTemplates
version: 1.0

[ClickHouse Operator] SHALL support rataining of volume claim templates
after deletion of [CHI] resource which SHALL work on [CHI], shard and replica levels.

### Reconnecting Existing Persistent Volumes

#### RQ.SRS-026.ClickHouseOperator.ReconnectingExistingPersistentVolumes
version: 1.0

[ClickHouse Operator] SHALL support reconnecting existing persistent volumes ([PV]s).

### Maintaining Cluster Uptime During Changes

#### RQ.SRS-026.ClickHouseOperator.MaintainingClusterUpTimeDuringChanges
version: 1.0

[ClickHouse Operator] SHALL maintain [ClickHouse] clusters operational
during application of changes to [CHI] resource.

Specific cases:

* inserts and selects to and from Distributed tables SHALL not be interrupted

### Adding New Persistent Volumes To Pods

#### RQ.SRS-026.ClickHouseOperator.AddingNewPersistentVolumesToPods
version: 1.0

[ClickHouse Operator] SHALL support adding new persistent volumes ([PV]s)
to managed [Pod]s.

### Interrupting Application of ClickHouse Cluster Changes

#### RQ.SRS-026.ClickHouseOperator.InterruptingApplicationOfClickHouseClusterChanges
version: 1.0

[ClickHouse Operator] SHALL support interrupting application of changes to [ClickHouse]
clusters.

For example when [CHI] manifest contains a user mistake that specifies
creation of a large number of replicas.

### Managing ClickHouse

#### Configuring TLS

##### RQ.SRS-026.ClickHouseOperator.Managing.TLS
version: 1.0

[ClickHouse Operator] SHALL support configuring (TLS) secure access to [ClickHouse]
cluster nodes and inter-cluster communication.

#### Restarting ZooKeeper Cluster

##### RQ.SRS-026.ClickHouseOperator.Managing.RestartingZooKeeper
version: 1.0

[ClickHouse Operator] SHALL support read-only access to [ClickHouse] clusters
while [ZooKeeper] cluster is being restarted. Once [ZooKeeper] is back up
then all [ClickHouse] clusters that use that [ZooKeeper] SHALL return to
read/write mode.

#### Application of Changes

##### RQ.SRS-026.ClickHouseOperator.Managing.Changes
version: 1.0

[ClickHouse Operator] SHALL apply all changes in a sequential order host-by-host in scope of [CHI].

#### Rollback On Error

##### RQ.SRS-026.ClickHouseOperator.Managing.RollbackOnError
version: 1.0

[ClickHouse Operator] SHALL support roll-back in case of error to make sure [ClickHouse] is operational.
This MAY result in inconsistent state where actual state is different from [CHI].

#### Changes Requiring Restart

##### RQ.SRS-026.ClickHouseOperator.Managing.ChangesRequiringRestart
version: 1.0

[ClickHouse Operator] SHALL support changes that MAY require a restart of [ClickHouse],
in particular:

* changes to [ZooKeeper] configuration
* changes to [ClickHouse] server settings (as opposed to users/profiles that do not require a restart)
* changes to [Pod] templates, e.g. version change

#### Configuration And Settings

##### RQ.SRS-026.ClickHouseOperator.Managing.ConfigurationAndSettings
version: 1.0

[ClickHouse Operator] SHALL support managing [ClickHouse] server configuration
or users/profiles configuration and settings including [ZooKeeper] integration.

#### Cluster Scaling

##### Adding Shards

###### RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.AddingShards
version: 1.0

[ClickHouse Operator] SHALL support adding shards to [CHI] with schema propagation.

##### Adding Replicas

###### RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.AddingReplicas
version: 1.0

[ClickHouse Operator] SHALL support adding additional replicas to [CHI] with schema propagation. ClickHouse shall remain available during this operation.

##### Adding Replication To Existing Non-replicated Cluster

###### RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.AddingReplicationToExistingNonReplicatedCluster
version: 1.0

[ClickHouse Operator] SHALL support adding replication to existing non-replicated cluster
only if ReplicatedMergeTree tables are being used.

##### Schema Propagation

###### RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.SchemaPropagation
version: 1.0

[ClickHouse Operator] SHALL support automatic schema propagation for
when adding new shards or replicas

* Distributed tables
* tables used by Distributed tables (underlying tables)

All schema objects SHALL be migrated to new cluster nodes. Schema objects include but not limited to

* database engines
* tables engines
* views
* dictionaries

##### Scaling Down

###### RQ.SRS-026.ClickHouseOperator.Managing.ClusterScaling.Down
version: 1.0

[ClickHouse Operator] SHALL support [ClickHouse] cluster scaling down shards and replicas.

Scaling down shards MAY result in loss of data.

#### ClickHouse Version Upgrades

##### RQ.SRS-026.ClickHouseOperator.Managing.VersionUpgrades
version: 1.0

[ClickHouse Operator] SHALL support [ClickHouse] server version upgrades
on one shard, one replica or entire cluster.

##### RQ.SRS-026.ClickHouseOperator.Managing.VersionUpgrades.IndividualOrAll
version: 1.0

[ClickHouse Operator] SHALL support upgrading [ClickHouse] version for each
pod individually or all pods at the same time.

#### Re-provisioning Pods Using Different Template

##### RQ.SRS-026.ClickHouseOperator.Managing.ReprovisioningPodsUsingDifferentTemplate
version: 1.0

[ClickHouse Operator] SHALL support re-provisioning [Pod]s using a different template.

#### StorageManagement switch

##### RQ.SRS-026.ClickHouseOperator.Managing.StorageManagementSwitch
version: 1.0

[ClickHouse Operator] SHALL support switching storageManagement from default to Operator.

#### Stopping And Starting

##### RQ.SRS-026.ClickHouseOperator.Managing.StoppingAndStarting
version: 1.0

[ClickHouse Operator] SHALL support stopping and starting [CHI] entirely.

#### Stopping Specific ClickHouse Pods

##### RQ.SRS-026.ClickHouseOperator.Managing.StoppingSpecificClickHousePods
version: 1.0

[ClickHouse Operator] SHALL support stopping specific [ClickHouse] [Pod]s completely.

#### Stopping Specific ClickHouse Hosts

##### RQ.SRS-026.ClickHouseOperator.Managing.StoppingSpecificClickHouseHosts
version: 1.0

[ClickHouse Operator] SHALL support stopping specific [ClickHouse] hosts
for a maintenance on a running [Pod] that SHALL require providing custom [Pod] template
with an entry point.

#### Exporting Metrics

##### RQ.SRS-026.ClickHouseOperator.Managing.ExportingMetrics
version: 1.0

[ClickHouse Operator] SHALL support exporting [ClickHouse] metrics to [Prometheus]
including after restart of operator.

#### Monitoring

##### RQ.SRS-026.ClickHouseOperator.Managing.Monitoring
version: 1.0

[ClickHouse Operator] SHALL support updating the status and recording
relevant events for [CHI] resource that can be observed and monitored separately.

#### Rolling Update

##### RQ.SRS-026.ClickHouseOperator.Managing.RollingUpdate
version: 1.0

[ClickHouse Operator] SHALL support rolling update of an existing cluster where
each [Pod] of the [ClickHouse] cluster is updated one at a time with only one [Pod]
being offline during rolling update.

### Logging

##### RQ.SRS-026.ClickHouseOperator.Logging
version: 1.0

[ClickHouse Operator] SHALL support writing logs for each [Pod] that SHALL be
accessible using `kubectl logs` or, if present, [Kubernetes] cluster monitoring.

##### High Level Status

###### RQ.SRS-026.ClickHouseOperator.Logging.HighLevelStatus
version: 1.0

[ClickHouse Operator] SHALL support writing high level status in [CHI] object and
SHALL log warnings and errors as events. Both SHALL be accessible with `kubectl describe`.


### Valid Installation

#### RQ.SRS-026.ClickHouseOperator.ValidInstallation
version: 1.0

After installing [ClickHouse Operator] the following commands SHALL work

* `kubectl get deployment clickhouse-operator -n kube-system` that SHALL return one deployment, for example

``` bash
NAME                  READY   UP-TO-DATE   AVAILABLE   AGE
clickhouse-operator   1/1     1            1           21d
```

* `kubectl get configmap --all-namespaces | grep clickhouse-operator` that SHALL return five config maps, for example

```bash
kube-system          etc-clickhouse-operator-files                      1      21d
kube-system          etc-clickhouse-operator-confd-files                0      21d
kube-system          etc-clickhouse-operator-configd-files              4      21d
kube-system          etc-clickhouse-operator-templatesd-files           4      21d
kube-system          etc-clickhouse-operator-usersd-files      
```

* `kubectl get crd | grep clickhouse` that SHALL return three resource definitions

### Operator Settings

#### config.yaml

##### RQ.SRS-026.ClickHouseOperator.Settings.ConfigYaml
version: 1.0

[ClickHouse Operator] SHALL support configuration using
`/etc/clickhouse-operator/config.yaml`.

#### Config Map

##### RQ.SRS-026.ClickHouseOperator.Settings.ConfigMap
version: 1.0

[ClickHouse Operator] SHALL support configuration using
`etc-clickhouse-operator-files` [ConfigMap].

##### RQ.SRS-026.ClickHouseOperator.Settings.ConfigMap.Changes
version: 1.0

[ClickHouse Operator] MAY not monitor changes to `etc-clickhouse-operator-files` [ConfigMap]
but changes SHALL be picked up if operator is restarted.

#### `ClickHouseOperatorConfiguration` Resource

##### RQ.SRS-026.ClickHouseOperator.Settings.ClickHouseOperatorConfiguration
version: 1.0

[ClickHouse Operator] SHALL support configuration using
`etc-clickhouse-operator-files` [ConfigMap] defined using `ClickHouseOperatorConfiguration`
resource.

##### RQ.SRS-026.ClickHouseOperator.Settings.ClickHouseOperatorConfiguration.Changes
version: 1.0

[ClickHouse Operator] SHALL monitor changes to `ClickHouseOperatorConfiguration` resource
and SHALL apply them immediately.

### ClickHouse Config Maps

#### RQ.SRS-026.ClickHouseOperator.ClickHouse.ConfigMaps
version: 1.0

[ClickHouse Operator] SHALL create and manage the following [ConfigMap]s
which SHALL be responsible for [ClickHouse] server configuration and
mounted to corresponding configuration folders of each [ClickHouse] pods:

* `etc-clickhouse-operator-confd-files`
* `etc-clickhouse-operator-configd-files`
* `etc-clickhouse-operator-usersd-files`

### ClickHouse Config Maps Defaults

#### RQ.SRS-026.ClickHouseOperator.ClickHouse.ConfigMaps.Defaults
version: 1.0

[ClickHouse Operator] SHALL specify the defaults for [ClickHouse] [ConfigMaps]
in `manifests/operator/clickhouse-operator-install.yaml`.

### Custom Resource Definition

#### RQ.SRS-026.ClickHouseOperator.CustomResource.CustomResourceDefinition
version: 1.0

[ClickHouse Operator] SHALL provide [custom resource definition] file
`clickhouse-operator-install-bundle.yaml` that
SHALL provide support for defining [ClickHouse] custom resource installations.

### API Version

#### RQ.SRS-026.ClickHouseOperator.CustomResource.APIVersion
version: 1.0

[ClickHouse Operator] SHALL support defining custom resource definition
using the following API versions

* `clickhouse.altinity.com/v1`

```yaml
apiVersion: "clickhouse.altinity.com/v1"
```

### Resource Kind

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Kind.ClickHouseInstallation
version: 1.0

[ClickHouse Operator] SHALL provide support to define custom resources
of the `ClickHouseInstallation` kind specified using `.kind` property.

`ClickHouseInstallation` resources SHALL be accessible using `chi` short name.

For example,

```yaml
kind: "ClickHouseInstallation"
```

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Kind.ClickHouseInstallationTemplate
version: 1.0

[ClickHouse Operator] SHALL provide support to define custom resources
of the `ClickHouseInstallationTemplate` kind specified using `.kind` property
and SHALL define in whole or in part `ClickHouseIntallation` resource.

`ClickHouseInstallationTemplate` resources SHALL be accessible using `chit`
short name.

`ClickHouseInstallationTemplate` reouces SHALL support the same spec
as the `ClickHouseInstallation` resource kind.

For example,

```yaml
kind: "ClickHouseInstallationTemplate"
```
#### RQ.SRS-026.ClickHouseOperator.CustomResource.Kind.ClickHouseOperatorConfiguration
version: 1.0

[ClickHouse Operator] SHALL provide support to define custom resources
of the `ClickHouseOperatorConfiguration` kind specified using `.kind` property
that SHALL support configuring operator behavior.

`ClickHouseOperatorConfiguration` resources SHALL be accessible using `chopconf`
short name.

For example,

```yaml
kind: "ClickHouseOperatorConfiguration"
```

### Metadata

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Metadata
version: 1.0

[ClickHouse Operator] SHALL provide support to define metadata for the custom resource
manifest using `.metadata` object that SHALL provide custom resource identification.

For example,

```yaml
metadata:
  name: "clickhouse-installation-max"
```

### Cluster Specification

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec
version: 1.0

[ClickHouse Operator] SHALL provide support to define specification of the desired
behavior of one or more ClickHouse clusters using `.spec` object inside the custom
resource manifest.

For example,

```yaml
spec:
```

### Task Identifier

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.TaskID
version: 1.0

[ClickHouse Operator] SHALL allow defining custom _taskID_ for named update
and watching status of this update execution in `.status.taskID`'s field
using `spec.taskID` property that SHALL be of [string] type.

By default, every update of the custom resource manifest SHALL generate random _taskID_.

### Stopping ClickHouse Clusters

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Stop
version: 1.0

[ClickHouse Operator] SHALL allow stopping all ClickHouse clusters described in current
custom resource manifest using `.spec.stop` property that SHALL use [bool enum] type.
where stop mechanism SHALL work as follows:

* if `stop` is `1` then setup `Replicas: 0` in each
  [StatefulSet] resource, all [Pod]s and [Service] resources will be destroyed,
  but [PVC]s SHALL still live

* if `stop` is `0` then [Pod]s will be created again and will attach retained
  [PVC]s and [Service] also will be created again

For example,

```yaml
spec:
  stop: "no"
```

### Restart Policy For StatefulSets

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Restart
version: 1.0

[ClickHouse Operator] SHALL allow specifying restart policy for [StatefulSets]
using `.spec.restart` property that SHALL support rolling restart.

The only supported value is `RollingUpdate` that SHALL allow graceful restart
of each [Pod] one by one instead of restarting all [Pod]s simultaneously.

The `RollingUpdate` SHALL be the default value if not specified.

For example,

```yaml
spec:
  restart: "RollingUpdate"
```

### Troubleshooting Pods

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Troubleshoot
version: 1.0

[ClickHouse Operator] SHALL allow troubleshooting [Pods] during _CrashLoopBack_ state
when user applies wrong configuration by specifying `.spec.troubleshoot`
property of [bool enum] type. For example, the `clickhouse-server` does not start.

If value is set to `yes` then the `kubectl exec -n <namespace-name> <pod-name> bash` SHALL provide access to the [Pod] shell.

For example,

```yaml
spec:
  troubleshoot: "no"
```

### Custom Domain Suffix

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.NamespaceDomainPattern
version: 1.0

[ClickHouse Operator] SHALL support specifying custom domain suffix
for [Service] or [Pod] names when custom cluster domain is used in [Kubernetes] cluster
by specifying `.spec.namespaceDomainPattern` property of [string] type.

For example,

```yaml
spec:
  namespaceDomainPattern:  "%s.svc.my.test"
```

### Policy For Auto Applying Templates

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templating
version: 1.0

[ClickHouse Operator] SHALL support specifying policy for
auto applying _ClickHouseInstallationTemplate_ inside [CHI]
by specifying `.spec.templating.policy` property inside the `.spec.templating` object.

* if `auto` it SHALL auto add ClickHouseInstallationTemplate into all [CHI]s
* if `manual` it SHALL not auto add ClickHouseInstallationTemplate into all [CHI]s (default)

For example,

```yaml
spec:
  templating:
    policy: "manual"
```

### Reconciling Cycle

[ClickHouse Operator] executes reconciliation cycle any time [CHI]
change is detected. The reconciliation cycle consists of the following
steps:

1. User creates or updates custom resources
2. Operator watches for events related its custom resources
3. Operator tries to create or update [CHI] to match the new state
  * Services
      * CHI level (only one)
      * cluster level (one for each cluster)
      * shard level (one for each shard inside cluster)
      * replica level (one for each replica inside a shard)
  * ConfigMaps
      * users.d (/etc/clickhouse-server/users.d) cluster level
      * config.d (/etc/clickhouse-server/config.d) cluster level
      * conf.d (/etc/clickhouse-server) replica level
  * PVC
  * StatefulSet

#### RQ.SRS-026.ClickHouseOperator.ReconcilingCycle
version: 1.0

[ClickHouse Operator] SHALL support reconciling current and desired state of [CHI]
using reconcicling cycle based on the custom resource specification
that result in either successful or failed [CHI] state.

#### Applying ConfigMaps Before StatefulSets

##### RQ.SRS-026.ClickHouseOperator.ReconcilingCycle.ApplyingConfigMapsBeforeStatefulSets
version: 1.0

[ClickHouse Operator] SHALL create or update [ConfigMap]s before any changes to [StatefulSet]s.

#### Configuring Reconciling Cycle

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling
version: 1.0

[ClickHouse Operator] SHALL support tuning reconciling cycle for [CHI]
from ClickHouse operator side using `.spec.reconciling` object.

For example,

```yaml
spec:
  reconciling:
```
#### Reconciliation Policy Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Policy
version: 1.0

[ClickHouse Operator] SHALL support specifying a name for the reconciliation cycle policy
using `.spec.reconciling.policy` property of [string] type.

For example,

```yaml
spec:
  reconciling:
    policy: "nowait"
```

#### ConfigMap Propagation Timeout

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.ConfigMapPropagationTimeout
version: 1.0

[ClickHouse Operator] SHALL support specifying timeout in seconds
using `.spec.reconciling.configMapPropagationTimeout` property with [integer] type
that operator SHALL wait when applying [ConfigMap] during reconciliation of the [CHI].

[Pods] SHALL be updated from cache as specified in
https://kubernetes.io/docs/concepts/configuration/configmap/#mounted-configmaps-are-updated-automatically

For example,

```yaml
spec:
  reconciling:
    configMapPropagationTimeout: 90
```

#### Cleaning Objects

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Cleanup
version: 1.0

[ClickHouse Operator] SHALL support defining behavior for cleaning up [Kubernetes]
resources during reconcile cycle using `.spec.reconciling.cleanup` object.

For example,

```yaml
spec:
  reconciling:
    cleanup:
```

#### Cleaning Up Unknown Objects

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Cleanup.UnknownObjects
version: 1.0

[ClickHouse Operator] SHALL support specifying what operator SHALL do when it finds
[Kubernetes] resources which should be managed by the operator, but do not have
`ownerReference` for any currently managed [CHI] resource using
`.spec.reconciling.cleanup.unknownObjects` object.

The following properties SHALL be supported having [string] type containing
either `Retain` or `Delete` values that SHALL specify the cleanup behavior
for the respective [Kubernetes] resources.

* [StatefulSet]
  using `.spec.reconciling.cleanup.unknownObjects.statefulSet` property
* [PVC]
  using `.spec.reconciling.cleanup.unknownObjects.pvc` property
* [ConfigMap]
  using `.spec.reconciling.cleanup.unknownObjects.configMap` property
* [Service]
  using `.spec.reconciling.cleanup.unknownObjects.service` property

The default behavior SHALL be `Delete` for each.

For example,

```yaml
spec:
  reconciling:
    cleanup:
      unknownObjects:
        statefulSet: Delete
        pvc: Delete
        configMap: Delete
        service: Delete
```

#### Reconciling Failed Objects

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Reconciling.Cleanup.ReconcileFailedObjects
version: 1.0

[ClickHouse Operator] SHALL support specifying what operator shall do when
reconciling [Kubernetes] resources that are failed using
`.spec.reconciling.cleanup.reconcileFailedObjects` object.

The following properties SHALL be supported having [string] type containing
either `Retain` or `Delete` values that SHALL specify the behavior
for the respective failed [Kubernetes] resources.

* [StatefulSet]
  using `.spec.reconciling.cleanup.reconcileFailedObjects.statefulSet` property
* [PVC]
  using `.spec.reconciling.cleanup.reconcileFailedObjects.pvc` property
* [ConfigMap]
  using `.spec.reconciling.cleanup.reconcileFailedObjects.configMap` property
* [Service]
  using `.spec.reconciling.cleanup.reconcileFailedObjects.service` property

The default behavior is SHALL be `Retain` for each property.

### Defaults

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults
version: 1.0

[ClickHouse Operator] SHALL support defining the default behavior for whole
[CHI] with the ability to re-define some behavior on cluster, shard and or replica level
using `.spec.defaults` object.

For example,

```yaml
spec:
  defaults:
```

#### Specifying Replicas By FQDN

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.ReplicasUseFQDN
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.replicasUseFQDN` property
with [bool enum] type that SHALL define if replicas SHALL be specified by FQDN in `<host></host>`.

If the value is `"no"` then it SHALL use short hostname and `clickhouse-server`
SHALL use [Kubernetes] default suffixes for proper DNS lookup.

The default value SHALL be `"yes"`.

For example,

```yaml
spec:
  defaults:
    replicasUseFQDN: "no"
```

#### Changing Distributed_DDL Settings

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.DistributedDDL
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.distributedDDL` object
that SHALL allow to specify `<yandex><distributed_ddl></distributed_ddl></yandex>`
[ClickHouse] server settings
(https://clickhouse.tech/docs/en/operations/server-configuration-parameters/settings/#server-settings-distributed_ddl).

Each property of the object SHALL map to the corresponding setting name and value.

For example,

```yaml
spec:
 defaults:
    distributedDDL:
      profile: default
```

#### Templates

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates` object
that SHALL support specifying templates names which operator will use
to generate [Kubernetes] resources according to one or more [ClickHouse]
clusters described in current [CHI] resource.

For example,

```yaml
spec:
  defaults:
    templates:
```

##### Host Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.HostTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.hostTemplate` property of
[string] type that SHALL specify template name from `.spec.templates.hostTemplates`
which SHALL be applied to configure every `clickhouse-server` instance during rendering of
[ConfigMap] resources that will mount into [Pod].

For example,

```yaml
spec:
  defaults:
    templates:
      hostTemplate: host-template-custom-ports
```

##### Pod Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.PodTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.podTemplate` property
of [string] type that SHALL specify template name from `.spec.templates.podTemplates`
that SHALL allow customization of each `Pod` resource during rendering and reconciliation
of each `StatefulSet.spec` resource described in `.spec.configuration.clusters`.

For example,

```yaml
spec:
  defaults:
    templates:
      podTemplate: clickhouse-v20.6
```

##### Data Volume Claim Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.dataVolumeClaimTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.dataVolumeClaimTemplate` property
of [string] type that SHALL specify template name from `.spec.templates.dataVolumeClaimTemplates`
that SHALL allow customization of each [PVC] which will mount for clickhouse data directory
in each [Pod] during render and reconcile every `StatefulSet.spec` resource described
in `.spec.configuration.clusters`.

For example,

```yaml
spec:
 defaults:
    templates:
      dataVolumeClaimTemplate: default-volume-claim
```

##### Log Volume Claim Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.logVolumeClaimTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.defaults.templates.logVolumeClaimTemplate` property
of [string] type that SHALL specify template name from `.spec.templates.volumeClaimTemplates`
that SHALL allow customization of each [PVC] which will mount for clickhouse log directory
in each [Pod] during render and reconcile every `StatefulSet.spec` resource described
in `.spec.configuration.clusters`.

For example,

```yaml
spec:
 defaults:
    templates:
      logVolumeClaimTemplate: default-volume-claim
```

##### Service Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ServiceTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.serviceTemplate` property
of [string] type that SHALL specify template name from `.spec.templates.serviceTemplates`
that SHALL allow customization for one [Service] resource which will created by operator
for all clusters in whole [CHI] resource.

For example,

```yaml
spec:
  defaults:
    templates:
      serviceTemplate: chi-service-template
```

##### Cluster Service Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ClusterServiceTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.clusterServiceTemplate` property
of [string] type that SHALL specify template name from `.spec.templates.serviceTemplates`
that SHALL allow customization for each [Service] resource
which will created by operator for each clickhouse cluster described in
`.spec.configuration.clusters`.

For example,

```yaml
spec:
  defaults:
    templates:
      clusterServiceTemplate: cluster-service-template
```

##### Shard Service Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ShardServiceTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.shardServiceTemplate` property
of [string] type that SHALL specify template name from `.spec.templates.serviceTemplates`
that SHALL allow customization for each [Service] resource which will created by
operator for each shard inside clickhouse cluster described in `.spec.configuration.clusters`.

For example,

```yaml
spec:
  defaults:
    templates:
      shardServiceTemplate: shard-service-template
```

##### Replica Service Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.ReplicaServiceTemplate
version: 1.0

[ClickHouse Operator] SHALL support `.spec.defaults.templates.replicaServiceTemplate` property
of [string] type that SHALL specify template name from `chi.spec.templates.serviceTemplates`
that SHALL allow customization for each [Service] resource which will created by
operator for each replica inside each shard inside each clickhouse cluster
described in `.spec.configuration.clusters`.

For example,

```yaml
spec:
  defaults:
    templates:
      replicaServiceTemplate: replica-service-template
```

##### Volume Claim Template

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Defaults.Templates.VolumeClaimTemplate
version: 1.0

[ClickHouse Operator] SHALL treat `.spec.defaults.templates.volumeClaimTemplate`
of [string] type as _deprecated_ in favor of `dataVolumeClaimTemplate`
and `logVolumeClaimTemplate` properties.

### ClickHouse Server Configuration

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration
version: 1.0

[ClickHouse Operator] SHALL allow configuration of multiple aspects and
behavior of `clickhouse-server` instances while also allowing
description of multiple `clickhouse-server` clusters inside one [CHI] resource
using `.spec.configuration` object.

For example,

```yaml
spec:
  configuration:
```

#### ZooKeeper

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper
version: 1.0

[ClickHouse Operator] SHALL allow configuration of settings in
`<yandex><zookeeper></zookeeper></yandex>` section in each [Pod] when generating [ConfigMap]
which SHALL be mounted in `/etc/clickhouse-server/config.d/` using
`.spec.configuration.zookeeper` object.

The operator itself SHALL not manage [ZooKeeper] which and user SHALL install
[ZooKeeper] separately.

For example,

```yaml
spec:
  configuration:
    zookeeper:
```

##### ZooKeeper Nodes

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.Nodes
version: 1.0

[ClickHouse Operator] SHALL support description of every available [ZooKeeper]
cluster node for interaction using `.spec.configuration.zookeer.nodes`
of the [array] type.

Each item of the array SHALL specify the following properties:

* `host` property of [string] type that SHALL contain DNS name or IP address for [ZooKeeper] node
* `port` property of [integer] type with minimum of `0` and maximum of `65535`
  that SHALL specify the TCP port which SHALL be used to connect to [ZooKeeper] node

For example,

```yaml
spec
  configuration:
    zookeeper:
      nodes:
        - host: zookeeper-0.zookeepers.zoo3ns.svc.cluster.local
          port: 2181
        - host: zookeeper-1.zookeepers.zoo3ns.svc.cluster.local
          port: 2181
        - host: zookeeper-2.zookeepers.zoo3ns.svc.cluster.local
          port: 2181
```

##### Session Timeout

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.SessionTimeoutMs
version: 1.0

[ClickHouse Operator] SHALL support specifying session timeout in `ms` during connection to
[ZooKeeper] using `.spec.configuration.zookeeper.session_timeout_ms` property
of [integer] type.

For example,

```yaml
spec:
  configuration:
    zookeeper:
      session_timeout_ms: 30000
```

##### Operation Timeout

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.OperationTimeoutMs
version: 1.0

[ClickHouse Operator] SHALL support specifying operation timeout in `ms` during  
[ZooKeeper] transactions using `.spec.configuration.zookeeper.operation_timeout_ms` property
of [integer] type.

For example,

```yaml
spec:
  configuration:
    zookeeper:
      operation_timeout_ms: 10000
```

##### Root Path

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.Root
version: 1.0

[ClickHouse Operator] SHALL support specifying root znode path usded inside [ZooKeeper]
to store [ClickHouse] related data, such as replication queue or distributed DDL,
using `.spec.configuration.zookeeper.root` property of [string] type.

For example,

```yaml
spec:
  configuration:
    zookeeper:
      root: "/path/to/zookeeper/root/node"
```

##### Login Credentials

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.ZooKeeper.Identify
version: 1.0

[ClickHouse Operator] SHALL support specifying access credentials string in the
`user:password` format that SHALL be used for digest authorization with [ZooKeeper]
using `.spec.configuration.zookeeper.identity` property of [string] type.

For example,

```yaml
spec:
  configuration:
    zookeeper:
      identity: "user:password"
```

#### Users

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Users
version: 1.0

[ClickHouse Operator] SHALL support specifying settings
in `<yandex><users>..</users></yandex>` section of each [Pod] during generation of [ConfigMap]
mounted in `/etc/clickhouse-server/users.d/` using `.spec.configuration.users` object.

This object SHALL support specifying any setting defined in https://clickhouse.tech/docs/en/operations/settings/settings-users/.

For example,

```yaml
spec:
  configuration:
    users:
      readonly/profile: readonly
      #     <users>
      #        <readonly>
      #          <profile>readonly</profile>
      #        </readonly>
      #     </users>
      test/networks/ip:
        - "127.0.0.1"
        - "::/0"
      #     <users>
      #        <test>
      #          <networks>
      #            <ip>127.0.0.1</ip>
      #            <ip>::/0</ip>
      #          </networks>
      #        </test>
      #     </users>
      test/profile: default
      test/quotas: default
```

#### Profiles

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Profiles
version: 1.0

[ClickHouse Operator] SHALL support specifying settings
in `<yandex><profiles>..</profiles></yandex>` section of each [Pod] during generation of [ConfigMap]
mounted in `/etc/clickhouse-server/users.d/` using `.spec.configuration.profiles` object.

This object SHALL support specifying any setting defined in https://clickhouse.tech/docs/en/operations/settings/settings-profiles/.

For example,

```yaml
spec:
  configuration:
    profiles:
      readonly/readonly: "1"
      #      <profiles>
      #        <readonly>
      #          <readonly>1</readonly>
      #        </readonly>
      #      </profiles>
      default/max_memory_usage: "1000000000"
```

#### Quotas

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Quotas
version: 1.0

[ClickHouse Operator] SHALL support specifying settings
in `<yandex><quotas>..</quotas></yandex>` of each [Pod] during generation of [ConfigMap]
mounted in `/etc/clickhouse-server/users.d/` using `.spec.configuration.quotas` object.  

This object SHALL support specifying any setting defined in https://clickhouse.tech/docs/en/operations/quotas/.

For example,

```yaml
spec:
  configuration:
    quotas:
      default/interval/duration: "3600"
      #     <quotas>
      #       <default>
      #         <interval>
      #           <duration>3600</duration>
      #         </interval>
      #       </default>
      #     </quotas>
```
#### Settings

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying settings
in `<yandex>..</yandex>` section of each [Pod] during generation of [ConfigMap]
mounted in `/etc/clickhouse-server/config.d/` using `.spec.configuration.settings` object.  

This object SHALL support specifying any setting defined in https://clickhouse.tech/docs/en/operations/settings/settings/.

For example,

```yaml
spec:
  configuration:
    settings:
      compression/case/method: zstd
      #      <compression>
      #        <case>
      #          <method>zstd</method>
      #        </case>
      #      </compression>
      disable_internal_dns_cache: 1
      #      <disable_internal_dns_cache>1</disable_internal_dns_cache>
```

#### Files

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Files
version: 1.0

[ClickHouse Operator] SHALL support specifying content of any setting file inside each [Pod]
during generation of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
or `/etc/clickhouse-server/conf.d/` or `/etc/clickhouse-server/users.d/`.

Every key in this object SHALL specify the file name.
Every value in this object SHALL specify the file content.

Using `!!binary |` and base64 for binary files SHALL be supported as specified in
https://yaml.org/type/binary.html.

Each key SHALL support having one of the following prefixes

* `USERS`
* `COMMON`
* `HOST`
* `config.d`
* `users.d`
* `cond.d`

Wrong prefixes and sub-folders SHALL be ignored.

For example,

```yaml
spec:
  configuration:
    files:
      dict1.xml: |
        <yandex>
            <!-- ref to file /etc/clickhouse-data/config.d/source1.csv -->
        </yandex>
      source1.csv: |
        a1,b1,c1,d1
        a2,b2,c2,d2
```

### ClickHouse Clusters Configuration

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters
version: 1.0

[ClickHouse Operator] SHALL support description of ClickHouse clusters layout and SHALL
allow changing settings on cluster, shard and replica levels using
`.spec.configuration.cluster` object of [array] type.

Every cluster SHALL be a set of [StatefulSet].
One [StatefulSet] SHALL contain only one [Pod] with `clickhouse-server`.
All [Pods] SHALL render `<remote_server>` part of [ClickHouse] configs
mounted from ConfigMap as `/etc/clickhouse-server/config.d/chop-generated-remote_servers.xml`.

Clusters SHALL be configured to use Distributed table engine (https://clickhouse.tech/docs/en/engines/table-engines/special/distributed/).

A `cluster` MAY contain [ZooKeeper] settings that SHALL support inheriting from top [CHI] level.
A `cluster` SHALL support creating ReplicatedMergeTree tables
that interact with [ZooKeeper] nodes specified in `.spec.configuration.zookeer.nodes`.

#### Cluster Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying cluster name, used to identify a set of [ClickHouse]
servers and used during generating names of related [Kubernetes] resources using
`.spec.configuration.clusters[].name` array item property of type [string] having
minimum length of `1` and maximum length of `15` matching
`"^[a-zA-Z0-9-]{0,15}$"` pattern.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: all-counts
```

#### Cluster ZooKeeper

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.ZooKeeper
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex><zookeeper>..</zookeeper></yandex>`
section setting in each [Pod] only in current [ClickHouse] cluster used during generation
of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/` using
`.spec.configuration.clusters[].zookeeper` array item object that SHALL
support the same properties as for the top-level `.spec.configuration.zookeeper` object.

Any specified settings SHALL override top-level `.spec.configuration.zookeeper` settings.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        zookeeper:
```

#### Cluster Settings

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex>..</yandex>`
section settings in each [Pod] for one shard that SHALL be used during generation
of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
using `.spec.configuration.clusters[].settings` array item object that SHALL
support the same properties as for the top-level `.spec.configuration.settings` object.

Any specified settings SHALL override top-level `.spec.configuration.settings` and
cluster level `.spec.configuration.clusters.settings` settings.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        settings:
```

#### Cluster Files

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Files
version: 1.0

[ClickHouse Operator] SHALL support defining content of any settings file inside each [Pod]
only for one shard that SHALL be used during generation of [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/` or `/etc/clickhouse-server/conf.d/` or
`/etc/clickhouse-server/users.d/` using `.spec.configuration.clusters[].files` array
item object that SHALL support the same properties as for
the top level `.spec.configuration.files` object.

Any specified files SHALL override top level `.spec.configuration.files` and
cluster level `.spec.configuration.clusters.files` if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        files:
```

#### Cluster Templates

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Templates
version: 1.0

[ClickHouse Operator] SHALL support defining templates names which will used for
generation of [Kubernetes] resources according to selected shard using
`.spec.configuration.clusters[].templates` array item object that SHALL support
the same properties as the top level `.spec.defaults.templates` object.

The `serviceTemplate` SHALL be ignored for cluster-level.

Any specified templates SHALL override top level `.spec.default.templates`
and cluster level `.spec.configuration.clusters.templates` properties if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        templates:
          podTemplate: clickhouse-v20.6
          dataVolumeClaimTemplate: default-volume-claim
          logVolumeClaimTemplate: default-volume-claim
```

### ClickHouse Cluster Layout

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout
version: 1.0

[ClickHouse Operator] SHALL support specifying current cluster layout such as
how many shards SHALL be in cluster, how many replicas in each shard
and SHALL allow to override settings on each shard and replica separately.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: all-counts
        layout:
```

#### Layout Type (Deprecated)

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Type
version: 1.0

[ClickHouse Operator] SHALL treat `.spec.configuration.clusters[].layout.type`
property as _deprecated_.

#### Layout Shards Count

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.ShardsCount
version: 1.0

[ClickHouse Operator] SHALL support specifying how many shards for current [ClickHouse] cluster
will be created in [Kubernetes] using `.spec.configuration.clusters[].layout.shardsCount`
property of [integer] type. Each shard SHALL contain shared-nothing part of
data that MAY contain a set of replicas.

Cluster SHALL contain only one shard by default.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: my-cluster
        layout:
          shardsCount: 1
```

#### Layout Replicas Count

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.ReplicasCount
version: 1.0

[ClickHouse Operator] SHALL support specifying number of replicas for each shards
of the current [ClickHouse] cluster that will be created in [Kubernetes]
using `.spec.configuration.clusters[].layout.replicasCount` of [integer] type.

Each replica SHALL be a separate [StatefulSet] that SHALL contain only one [Pod]
with `clickhouse-server` instance.

Every shard SHALL contain only one replica by default.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: my-cluster
        layout:
          replicasCount: 1
```

#### Layout Shards

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards
version: 1.0

[ClickHouse Operator] SHALL support overriding top level `.spec.configuration` and
cluster level `.spec.configuration.clusters` settings for each shard separately
using `.spec.configuration.clusters[].layout.shards` array type object.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: my-cluster
        layout:
          shards:
```

##### Shard Name

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying custom shard name using
`.spec.configuration.clusters[].layout.shards[].name` array item property of [string] type
with min length of `1` and max length of `15` that matches `"^[a-zA-Z0-9-]{0,15}$"` pattern.

If not specified shard name SHALL be auto generated.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: my-cluster
        layout:
          shards:
            - name: custom-shard-name
```

##### Shard Definition Type (Deprecated)

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.DefinitionType
version: 1.0

[ClickHouse Operator] SHALL treat `.spec.configuration.clusters[].layout.shards[].definitionType`
property as _deprecated_.

##### Shard Weight

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Weight
version: 1.0

[ClickHouse Operator] SHALL support specifying shard `<weight>` setting which will be used
during insert into tables using `Distributed` engine.
This value SHALL be be applied in `<remote_servers>` inside [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/chop-generated-remote_servers.xml`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: my-cluster
        layout:
          shards:
            - name: custom-shard-name
              weight: 1
```

##### Shard Internnal Replication

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.InternalReplication
version: 1.0

[ClickHouse Operator] SHALL support specifying  `<internal_replication>` setting which
SHALL be used during insert into tables with `Distributed` engine using
`.spec.configuration.clusters[].layout.shards[].internalReplication` property of
[bool enum] type.

It SHALL support enabling insert only into one live replica while
other replicas SHALL download inserted data during replication.

The value SHALL be applied in `<remote_servers>` inside [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/chop-generated-remote_servers.xml`

The default value SHALL be `true` when `.spec.configuration.clusters[].layout.replicaCount` > `1` and `0` otherwise.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: my-cluster
        layout:
          shards:
            - name: custom-shard-name
              internalReplication: 1

##### Shard Settings

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex>..</yandex>`
section settings in each [Pod] for one shard that SHALL be used during generation
of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
using `.spec.configuration.clusters[].layout.shards[].settings` array item object that SHALL
support the same properties as for the top-level `.spec.configuration.settings` object.

Any specified settings SHALL override top-level `.spec.configuration.settings` and
cluster level `.spec.configuration.clusters.settings` settings.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard-name
              settings:
```

##### Shard Files

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Files
version: 1.0

[ClickHouse Operator] SHALL support defining content of any settings file inside each [Pod]
only for one shard that SHALL be used during generation of [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/` or `/etc/clickhouse-server/conf.d/` or
`/etc/clickhouse-server/users.d/` using `.spec.configuration.clusters[].layout.shards[].files` array
item object that SHALL support the same properties as for
the top level `.spec.configuration.files` object.

Any specified files SHALL override top level `.spec.configuration.files` and
cluster level `.spec.configuration.clusters.files` if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard-name
              files:
```

##### Shard Templates

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Templates
version: 1.0

[ClickHouse Operator] SHALL support defining templates names which will used for
generation of [Kubernetes] resources for the shard using
`.spec.configuration.clusters[].layout.shards[].templates` array item object that SHALL support
the same properties as the top level `.spec.defaults.templates` object.

* `serviceTemplate` SHALL be ignored for shard level.
* `clusterServiceTemplate` SHALL be ignored for shard level.

Any specified templates SHALL override top level `.spec.default.templates`
and cluster level `.spec.configuration.clusters.templates` properties if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: my-shard
              templates:
                podTemplate: clickhouse-v20.6
                dataVolumeClaimTemplate: default-volume-claim
                logVolumeClaimTemplate: default-volume-claim
```

##### Shard Replicas Count

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.ReplicasCount
version: 1.0

[ClickHouse Operator] SHALL support defining how many replicas SHALL be present in the
selected shard of the selected [ClickHouse] cluster that SHALL run in [Kubernetes]
using `.spec.configuration.clusters[].layout.shards[].replicasCount` array item property
of [integer] type with minimum value of `1`.

Each replica SHALL be a separate [StatefulSet] that SHALL contain only one [Pod]
with `clickhouse-server` instance and shard SHALL contain only one replica by default.

This property SHALL override cluster level `.spec.configuration.clusters.layout.replicasCount`
property if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        shards:
          - name: shard0
            replicasCount: 1
```

#### Layout Shards Replicas

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas
version: 1.0

[ClickHouse Operator] SHALL support overriding properties for selected replicas
from cluster level `.spec.configuration.clusters` and shard level
`.spec.configuration.clusters[].layout.shards` using
`.spec.configuration.clusters[].layout.shards[].replicas` array type object.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        shards:
          - name: shard0
            replicas:
```

##### Shard Replica Name

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying custom replica name
for a shard inside a cluster using `.spec.configuration.clusters[].layout.shards[].replicas[].name`
[string] type property with min length of `1` and max length of `15`
matching `"^[a-zA-Z0-9-]{0,15}$"` pattern.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        shards:
          - name: shard0
            replicas:
              - name: shard0-replica0
```

##### Shard Replica TCP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.TcpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying `Pod.spec.containers.ports`
with name `tcp` for select replica and overriding `.spec.templates.hostTemplates.spec.tcpPort`
that SHALL allow connecting to `clickhouse-server` via TCP Native protocol using
[Kubernetes] [Service] by using `.spec.configuration.clusters[].layout.shards[].replicas[].tcpPort`
[integer] type property with the minimum value of `1` and maximum value of `65535`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard0
              replicas:
                - name: shard0-replica0
                  tcpPort: 9000
```

##### Shard Replica HTTP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.HttpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying `Pod.spec.containers.ports`
with name `http` for the select replica and overriding `.spec.templates.hostTemplates.spec.httpPort`
that SHALL allow connecting to `clickhouse-server` via HTTP protocol using
[Kubernetes] [Service] by using `.spec.configuration.clusters[].layout.shards[].replicas[].httpPort`
[integer] type property with the minimum value of `1` and maximum value of `65535`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard0
              replicas:
                - name: shard0-replica0
                  httpPort: 8123
```

##### Shard Replica Inter-server HTTP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.InterServerHttpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying `Pod.spec.containers.ports`
with name `interserver` for the select replica and overriding `.spec.templates.hostTemplates.spec.interserverHTTPPort`
that SHALL allow connection between replicas inside the same shard during fetching replicated data parts via HTTP protocol
by using `.spec.configuration.clusters[].layout.shards[].replicas[].interserverHTTPPort`
[integer] type property with the minimum value of `1` and maximum value of `65535`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard0
              replicas:
                - name: shard0-replica0
                  interserverHTTPPort: 9009
```

##### Shard Replica Settings

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex>..</yandex>`
section settings in each [Pod] for one shard replica that SHALL be used during generation
of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
using `.spec.configuration.clusters[].layout.shards[].replicas[].settings` array item object that SHALL
support the same properties as for the `.spec.configuration.settings` object.

Any specified settings SHALL override top level `.spec.configuration.settings` and
cluster level `.spec.configuration.clusters.settings` and
shard level `.spec.configuration.clusters[].layout.shards[].settings` settings.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard-name
              replicas:
                - name: shard0-replica0
                  settings:
```

##### Shard Replica Files

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Files
version: 1.0

[ClickHouse Operator] SHALL support defining content of any settings file inside each [Pod]
only for one shard replica that SHALL be used during generation of [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/` or `/etc/clickhouse-server/conf.d/` or
`/etc/clickhouse-server/users.d/` using `.spec.configuration.clusters[].layout.shards[].files` array
item object that SHALL support the same properties as for
the `.spec.configuration.files` object.

Any specified files SHALL override top level `.spec.configuration.files` and
cluster level `.spec.configuration.clusters.files` and shard level
`.spec.configuration.clusters[].layout.shards[].files` settings if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: shard-name
              replicas:
                - name: shard0-replica0
                  files:
```

##### Shard Replica Templates

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Shards.Replicas.Templates
version: 1.0

[ClickHouse Operator] SHALL support defining templates names which will used for
generation of [Kubernetes] resources for the shard replica using
`.spec.configuration.clusters[].layout.shards[].replicas[].templates` array item object that SHALL support
the same properties as the top level `.spec.defaults.templates` object.

* `serviceTemplate` SHALL be ignored for replica level.
* `clusterServiceTemplate` SHALL be ignored for replica level.
* `shardServiceTemplate` SHALL be ignored for replica level.
* `shardServiceTemplate` SHALL be ignored for replica level.

Any specified templates SHALL override top level `.spec.default.templates`
and cluster level `.spec.configuration.clusters.templates` and
shard level `.spec.configuration.clusters[].layout.shards[].templates`
properties if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          shards:
            - name: my-shard
              replicas:
                - name: shard0-name0
                  templates:
                    podTemplate: clickhouse-v20.7
                    dataVolumeClaimTemplate: default-volume-claim
                    logVolumeClaimTemplate: default-volume-claim
                    replicaServiceTemplate: replica-service-template
```

#### Layout Replicas

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas
version: 1.0

[ClickHouse Operator] SHALL support overriding top level `.spec.configuration` and
cluster level `.spec.configuration.clusters` configuration for each replica
and each shard that is related to selected replica using
`.spec.configuration.clusters[].layout.replicas` array type object.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
```

##### Replica Name

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying custom replica name
for each replica and each shard for selected replica inside a cluster
using `.spec.configuration.clusters[].layout.replicas[].name`
[string] type property with min length of `1` and max length of `15`
matching `"^[a-zA-Z0-9-]{0,15}$"` pattern.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
```

##### Replica Settings

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex>..</yandex>`
section settings in each [Pod] for only one replica that SHALL be used during generation
of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
using `.spec.configuration.clusters[].layout.replicas[].settings` array item object that SHALL
support the same properties as for the `.spec.configuration.settings` object.

Any specified settings SHALL override top level `.spec.configuration.settings` and
cluster level `.spec.configuration.clusters.settings` but
will be ignored if shard level `.spec.configuration.clusters[].layout.shards`
settings is are present.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
                settings:
```

##### Replica Files

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Files
version: 1.0

[ClickHouse Operator] SHALL support defining content of any settings file inside each [Pod]
only for only one replica that SHALL be used during generation of [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/` or `/etc/clickhouse-server/conf.d/` or
`/etc/clickhouse-server/users.d/` using `.spec.configuration.clusters[].layout.replicas[].files` array
item object that SHALL support the same properties as for
the `.spec.configuration.files` object.

Any specified files SHALL override top level `.spec.configuration.files` and
cluster level `.spec.configuration.clusters.files` but will be ignored if shard level
`.spec.configuration.clusters[].layout.shards` settings are present.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              files:
```

##### Replica Templates

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Templates
version: 1.0

[ClickHouse Operator] SHALL support defining templates names which will used for
generation of [Kubernetes] resources for the selected replica using
`.spec.configuration.clusters[].layout.replicas[].templates` array item object that SHALL support
the same properties as the top level `.spec.defaults.templates` object.

* `serviceTemplate` SHALL be ignored for replica level.
* `clusterServiceTemplate` SHALL be ignored for replica level.
* `shardServiceTemplate` SHALL be ignored for replica level.

Any specified templates SHALL override top level `.spec.default.templates`
and cluster level `.spec.configuration.clusters.templates` properties if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              templates:
                podTemplate: clickhouse-v20.7
                dataVolumeClaimTemplate: default-volume-claim
                logVolumeClaimTemplate: default-volume-claim
                replicaServiceTemplate: replica-service-template
```

##### Replica Shards Count

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.ShardsCount
version: 1.0

[ClickHouse Operator] SHALL support specifying the number of shards related to
the current replica using `.spec.configuration.clusters[].layout.replicas[].shardsCount`
property of [integer] type with minimum number of `1`.

If specified it SHALL override each shard behavior specified in
`.spec.configuration.clusters[].layout.replicas[].shards`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shardsCount: 1
```

#### Layout Replicas Shards

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards
version: 1.0

[ClickHouse Operator] SHALL support specifying a list of shards related to the current replica
using `.spec.configuration.clusters[].layout.replicas[].shards` array type object.

This property SHALL be ignored if `.spec.configuration.clusters.layout.shards` is present.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
```

##### Replica Shard Name

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying custom shard name
for each shard for selected replica inside a cluster
using `.spec.configuration.clusters[].layout.replicas[].shards[].name`
[string] type property with min length of `1` and max length of `15`
matching `"^[a-zA-Z0-9-]{0,15}$"` pattern.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
```

##### Replica Shard TCP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.TcpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying `Pod.spec.containers.ports`
with name `tcp` for selected shard and overriding `.spec.templates.hostTemplates.spec.tcpPort`
that SHALL allow connecting to `clickhouse-server` via TCP Native protocol using
[Kubernetes] [Service] by using `.spec.configuration.clusters[].layout.replicas[].shards[].tcpPort`
[integer] type property with the minimum value of `1` and maximum value of `65535`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
                  tcpPort: 9000
```

##### Replica Shard HTTP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.HttpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying `Pod.spec.containers.ports`
with name `http` for the selected shard and overriding `.spec.templates.hostTemplates.spec.httpPort`
that SHALL allow connecting to `clickhouse-server` via HTTP protocol using
[Kubernetes] [Service] by using `.spec.configuration.clusters[].layout.replicas[].shards[].httpPort`
[integer] type property with the minimum value of `1` and maximum value of `65535`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
                  httpPort: 8123
```

##### Replica Shard Inter-server HTTP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.InterServerHttpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying `Pod.spec.containers.ports`
with name `interserver` for the selected shard and overriding `.spec.templates.hostTemplates.spec.interserverHTTPPort`
that SHALL allow connection between replicas inside the same shard during fetching replicated data parts via HTTP protocol
by using `.spec.configuration.clusters[].layout.replicas[].shards[].interserverHTTPPort`
[integer] type property with the minimum value of `1` and maximum value of `65535`.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
                  interserverHTTPPort: 9009
```

##### Replica Shard Settings

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex>..</yandex>`
section settings in each [Pod] for only one shard of the current replica that SHALL be used during generation
of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
using `.spec.configuration.clusters[].layout.replicas[].shards[].settings` array item object that SHALL
support the same properties as for the `.spec.configuration.settings` object.

Any specified settings SHALL override top level `.spec.configuration.settings`,
cluster level `.spec.configuration.clusters.settings`
and replica level `.spec.configuration.clusters[].layout.replicas.settings`
settings if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
                  settings:
```

##### Replica Shard Files

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Files
version: 1.0

[ClickHouse Operator] SHALL support defining content of any settings file inside each [Pod]
only for only one shard of the current replica that SHALL be used during generation of [ConfigMap] mounted in
`/etc/clickhouse-server/config.d/` or `/etc/clickhouse-server/conf.d/` or
`/etc/clickhouse-server/users.d/` using `.spec.configuration.clusters[].layout.replicas[].shards[].files` array
item object that SHALL support the same properties as for
the `.spec.configuration.files` object.

Any specified settings SHALL override top level `.spec.configuration.files` and
cluster level `.spec.configuration.clusters.files` but SHALL be ignored
if `.spec.configuration.clusters[].layout.shards` settings are present.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
                  files:
```

##### Replica Shard Templates

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Configuration.Clusters.Cluster.Layout.Replicas.Shards.Templates
version: 1.0

[ClickHouse Operator] SHALL support defining templates names which will used for
generation of [Kubernetes] resources for the selected shard replica using
`.spec.configuration.clusters[].layout.replicas[].shards[].templates` array item object that SHALL support
the same properties as the top level `.spec.defaults.templates` object.

* `serviceTemplate` SHALL be ignored for shard level
* `clusterServiceTemplate` SHALL be ignored for shard level

Any specified settings SHALL override top level `.spec.defaults.templates`,
cluster level `.spec.configuration.clusters.templates` and replica level
`.spec.configuration.clusters[].layout.replicas[].templates` settings if any.

For example,

```yaml
spec:
  configuration:
    clusters:
      - name: cluster-name
        layout:
          replicas:
            - name: replica0
              shards:
                - name: shard0-replica0
                  templates:
                    podTemplate: clickhouse-v20.7
                    dataVolumeClaimTemplate: default-volume-claim
                    logVolumeClaimTemplate: default-volume-claim
                    replicaServiceTemplate: replica-service-template
```

### User Defined Templates

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates
version: 1.0

[ClickHouse Operator] SHALL support specifying templates which SHALL be used
for rendering [Kubernetes] resources like [StatefulSet], [ConfigMap], [Service]
and [PVC] by default using `.spec.templates` object.

For example,

```yaml
spec:
  templates:
```

### Host Templates

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates
version: 1.0

[ClickHouse Operator] SHALL support specifying host templates
that SHALL be used to generate `clickhose-server` config files using
`.spec.templates.hostTemplates` array type object.

For example,

```yaml
spec:
  templates:
    hostTemplates:
```

#### Host Template Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying host template name that MAY be used
as a value in the following properties to provide default property values
for the selected resources:

* top level `.spec.defaults.templates.hostTemplate`
* cluster level `.spec.configuration.clusters.templates.hostTemplate`
* shard level `.spec.configuration.clusters.layout.shards.temlates.hostTemplate`
* replica level `.spec.configuration.clusters.layout.replicas.templates.hostTemplate`

using `.spec.templates.hostTemplates[].name` [string] type property.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
```

#### Host Template Port Distribution

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.PortDistribution
version: 1.0

[ClickHouse Operator] SHALL support specifying how to distribute numeric values of
named ports in `Pod.spec.containers.ports` and `clickhouse-server` configs
using `.spec.templates.hostTemplates[].portDistribution` array type object.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        portDistribution:
```

##### Port Distribution Type

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.PortDistribution.Type
version: 1.0

[ClickHouse Operator] SHALL support specifying the type of port distribution
using `.spec.templates.hostTemplates[].portDistribution[].type` property of
[string] type having one of the following values:

* if empty it SHALL use the default value

* if `Unspecified` then all listen ports on clickhouse-server
  configuration in all Pods SHALL have the same value. This value SHALL be the default.

* if `ClusterScopeIndex` then ports will increment to offset from base value depending
  on shard and replica index inside the cluster. With the combination of
  `.spec.templates.podTemlates.spec.HostNetwork` it SHALL allow setup [ClickHouse]
  cluster inside [Kubernetes] and provide access via external network bypassing [Kubernetes]
  internal network

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        portDistribution:
          - type: "ClusterScopeIndex"
```

#### Host Template Specification

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec
version: 1.0

[ClickHouse Operator] SHALL support specifying host template
properties `.spec.templates.hostTemplates[].spec` object.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        spec:
```

##### Host Name

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying custom host name for each `clickhuse-server`
using `.spec.templates.hostTemplates[].spec.name` [string] type property
with the minimum length of `1` and maximum length of `15` matching
`"^[a-zA-Z0-9-]{0,15}$"` pattern.

By default, host name SHALL be auto generated.     

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        spec:
          name: custom-host-name
```

##### Host TCP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.TcpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying custom `tcp_port` inside
`clickhouse-server` settings for each [Pod] where current template will be applied
using `.spec.templates.hostTemplates[].spec.tcpPort` [integer] type property
ranging from `1` to `65535`.

If specified, SHALL have equal value to `.spec.templates.podTemplates.spec.containers.ports[name=tcp]`.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        spec:
          tcpPort: 9000
```

##### Host HTTP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.HttpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying custom `http_port`
inside `clickhouse-server` settings for each [Pod] where current template will be applied
using `.spec.templates.hostTemplates[].spec.httpPort` [integer] type property
ranging from `1` to `65535`.

If specified, SHALL have equal value to `.spec.templates.podTemplates.spec.containers.ports[name=http]`.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        spec:
          httpPort: 8123
```

##### Host Inter-server HTTP Port

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.InterServerHttpPort
version: 1.0

[ClickHouse Operator] SHALL support specifying custom `interserver_http_port`
inside `clickhouse-server` settings for each [Pod] where current template will be applied
using `.spec.templates.hostTemplates[].spec.interserverHTTPPort` [integer] type property
ranging from `1` to `65535`.

If specified, SHALL have value equal to `.spec.templates.podTemplates.spec.containers.ports[name=interserver]`.

```yaml
spec:
  templates:
    hostTemplates:
      - name: host-template-custom-ports
        spec:
          interserverHTTPPort: 7002
```

##### Host Settings

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Settings
version: 1.0

[ClickHouse Operator] SHALL support specifying `<yandex>..</yandex>`
section settings in each [Pod] where this template will be applied
that SHALL be used during generation of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
using `.spec.templates.hostTemplates[].spec.settings` array item object that SHALL
support the same properties as for the `.spec.configuration.settings` object.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: custom-host-template
        spec:
          settings:
```

 optional, allows define content of any setting file inside each `Pod` where this template will apply during generate `ConfigMap`
 which will mount in `/etc/clickhouse-server/config.d/` or `/etc/clickhouse-server/conf.d/` or `/etc/clickhouse-server/users.d/`

##### Host Files

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Files
version: 1.0

[ClickHouse Operator] SHALL support defining content of any settings file
inside each [Pod] where this template will be applied
that SHALL be used during generation of [ConfigMap] mounted in `/etc/clickhouse-server/config.d/`
or `/etc/clickhouse-server/conf.d/` or `/etc/clickhouse-server/users.d/`
using `.spec.templates.hostTemplates[].spec.files` object and SHALL
support the same properties as the `.spec.configuration.files` object.

For example,

```yaml
spec:
  templates:
    hostTemplates:
      - name: custom-host-template
        spec:
          files:
```

##### Host Overriding Templates

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.HostTemplates.Spec.Templates
version: 1.0

[ClickHouse Operator] SHALL support overriding template inside a template
for each [Pod] where this template will be applied using
`.spec.templates.hostTemplates[].spec.templates` object that SHALL support the following
properties of [string] type that SHALL contain the name of the template
of the corresponding type from `spec.templates`

* `hostTemplate`
* `podTemplate`
* `dataVolumeClaimTemplate`
* `logVolumeClaimTemplate`
* `serviceTemplate`
* `clusterServiceTemplate`
* `shardServiceTemplate`
* `replicaServiceTemplate`

### Pod Templates

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates
version: 1.0

[ClickHouse Operator] SHALL support specifying [Pod] templates
that SHALL allow to render a `Pod` inside `StatefulSet.spec` and define
`Pod.spec`, [Pod] scheduling distribution and [Pod] zone using
`.spec.templates.podTemplates` array type object.

For example,

```yaml
spec:
  templates:
    podTemplates:
```

#### Pod Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying [Pod] template name that MAY be used
as a value in the following properties to provide default property values
for the selected resources:

* top level `.spec.defaults.templates.podTemplate`
* cluster level `.spec.configuration.clusters.templates.podTemplate`
* shard level `.spec.configuration.clusters.layout.shards.temlates.podTemplate`
* replica level `.spec.configuration.clusters.layout.replicas.templates.podTemplate`

using `.spec.templates.podTemplates[].name` [string] type property.

For example,

```yaml
spec:
  templates:
    podTemplates:
      - name: pod-template
```

#### Pod Generate Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.GenerateName
version: 1.0

[ClickHouse Operator] SHALL support specifying how to auto generate [Pod] template name
using `.spec.templates.podTemplates[].generateName` [string] type property that SHALL
specify the format.

The `generateName` property SHALL support the following macros
depending on the level of the object, for which [Service] is being created:

**For [CHI] level [Service]**
  * `{chi}` - ClickHouseInstallation name
  * `{chiID}` - short hashed ClickHouseInstallation name

**For cluster level [Service]**
  * `{chi}` - ClickHouseInstallation name
  * `{chiID}` - short hashed ClickHouseInstallation name
  * `{cluster}` - cluster name
  * `{clusterID}` - short hashed cluster name
  * `{clusterIndex}` - 0-based index of the cluster in the [CHI]

**For shard level [Service]**
  * `{chi}` - ClickHouseInstallation name
  * `{chiID}` - short hashed ClickHouseInstallation name
  * `{cluster}` - cluster name
  * `{clusterID}` - short hashed cluster name
  * `{clusterIndex}` - 0-based index of the cluster in the [CHI]
  * `{shard}` - shard name
  * `{shardID}` - short hashed shard name
  * `{shardIndex}` - 0-based index of the shard in the cluster

**For replica level [Service]**
  * `{chi}` - ClickHouseInstallation name
  * `{chiID}` - short hashed ClickHouseInstallation name
  * `{cluster}` - cluster name
  * `{clusterID}` - short hashed cluster name
  * `{clusterIndex}` - 0-based index of the cluster in the CHI
  * `{shard}` - shard name
  * `{shardID}` - short hashed shard name
  * `{shardIndex}` - 0-based index of the shard in the cluster
  * `{replica}` - replica name
  * `{replicaID}` - short hashed replica name
  * `{replicaIndex}` - 0-based index of the replica in the shard

For example,


```yaml
spec:
  templates:
    podTemplates:
      - name: pod-template
        generateName: "service-{chi}"
```

#### Pod Zone

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Zone
version: 1.0

[ClickHouse Operator] SHALL allow defining custom zone name to separate
[ClickHouse] [Pods] between nodes using `.spec.templates.podTemplates[].zone`
object.

This property SHALL serve as a shortcut for `.spec.templates.podTemplates[].spec.affinity.podAntiAffinity`.

For example,

```yaml
spec:
  templates:
    podTemplates:
      - name: pod-template
        zone:
```

##### Pod Zone Key

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Zone.Key
version: 1.0

[ClickHouse Operator] SHALL allow to select [Kubernetes] nodes by label
with `name` equal `key` specified using `.spec.templates.podTemplates[].zone.key` [string] type
property.

For example,

```yaml
spec:
  templates:
    podTemplates:
      - name: pod-template
        zone:
          key: "clickhouse"
```

##### Pod Zone Values

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Zone.Values
version: 1.0

[ClickHouse Operator] SHALL allow to select [Kubernetes] nodes by label with `value`
in `values` specified using `.spec.templates.podTemplates[].zone.values` [array] type
object where each item in the array SHALL be of [string] type.

For example,

```yaml
spec:
  templates:
    podTemplates:
      - name: pod-template
        zone:
          key: "clickhouse"
          values:
            - "allow"
```

#### Pod Distribution

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution
version: 1.0

[ClickHouse Operator] SHALL support defining [ClickHouse] [Pod] distibution policy
between [Kubernetes] nodes inside shard, replica, [Namespace], [CHI],
or another [ClickHouse] cluster using  `.spec.templates.podTemplates[].podDistribution`
[array] type object.

For example,

```yaml
spec:
  templates:
    podTemplates:
      - name: pod-template
        podDistribution:
```

##### Pod Distribution Type

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.Type
version: 1.0

[ClickHouse Operator] SHALL support defining multiple affinity policy types using
`.spec.templates.podTemplates[].podDistribution[].type` [string] type property
which SHALL support the following values:

* `""`
* `"Unspecified"`
* `"ClickHouseAntiAffinity"`
* `"ShardAntiAffinity"`
* `"ReplicaAntiAffinity"`
* `"AnotherNamespaceAntiAffinity"`
* `"AnotherClickHouseInstallationAntiAffinity"`
* `"AnotherClusterAntiAffinity"`
* `"MaxNumberPerNode"`
* `"NamespaceAffinity"`
* `"ClickHouseInstallationAffinity"`
* `"ClusterAffinity"`
* `"ShardAffinity"`
* `"ReplicaAffinity"`
* `"PreviousTailAffinity"`
* `"CircularReplication"`

##### Pod Distribution Scope

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.Scope
version: 1.0

[ClickHouse Operator] SHALL support defining scope for applying each `podDistribution`
using `.spec.templates.podTemplates[].podDistribution[].scope` [string] type property
which SHALL support the following values:

* `""`
* `"Unspecified"`
* `"Shard"`
* `"Replica"`
* `"Cluster"`
* `"ClickHouseInstallation"`
* `"Namespace"`

##### Pod Distribution Number

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.Number
version: 1.0

[ClickHouse Operator] SHALL support defining how many [ClickHouse] [Pods] could exist
inside the selected scope with the selected distribution type using
`.spec.templates.podTemplates[].podDistribution[].number` [integer] type property
having the minimum value of `0` and maximum value of `65535`.

##### Pod Distribution Topology Key

###### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.podDistribution.TopologyKey
version: 1.0

[ClickHouse Operator] SHALL support defining topology key used for inter-pod affinity
using `.spec.templates.podTemplates[].podDistribution[].topologyKey` [string] type property.

#### Pod Spec

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Spec
version: 1.0

[ClickHouse Operator] SHALL allow defining whole `Pod.spec` inside `StaefulSet.spec`
using `.spec.templates.podTemplates[].spec` object as
specified in https://kubernetes.io/docs/concepts/workloads/pods/#pod-templates.

#### Pod Metadata

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.PodTemplates.Metadata
version: 1.0

[ClickHouse Operator] SHALL allow passing standard object's metadata from template to [Pod]
using `.spec.templates.podTemplates[].metadata` object as
specified in https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata.

### Volume Claim Templates

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates
version: 1.0

[ClickHouse Operator] SHALL allow defining templates for rendering [PVC]
resources which would be used inside [Pod]s for mounting [ClickHouse]
`data`, `logs` or other folders using `.spec.templates.volumeClaimTemplates`
[array] type object.

For example,

```yaml
spec:
  templates:
    volumeClaimTemplates:
```

#### Volume Claim Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying `VolumeClaimTemplate` name that MAY be used
as a value in the following properties to provide default property values
for the selected resources:

* top level `.spec.defaults.templates.dataVolumeClaimTemplate` or `.spec.defaults.templates.logVolumeClaimTemplate`
* cluster level `.spec.configuration.clusters.templates.dataVolumeClaimTemplate` or `.spec.configuration.clusters.templates.logVolumeClaimTemplate`
* shard level `.spec.configuration.clusters.layout.shards.temlates.dataVolumeClaimTemplate` or `.spec.configuration.clusters.layout.shards.temlates.logVolumeClaimTemplate`
* replica level `.spec.configuration.clusters.layout.replicas.templates.dataVolumeClaimTemplate` or `.spec.configuration.clusters.layout.replicas.templates.logVolumeClaimTemplate`

using `.spec.templates.volumeClaimTemplates[].name` [string] type property.

For example,

```yaml
spec:
  templates:
    volumeClaimTemplates:
      - name: default-volume-template
```

#### Volume Claim Reclaim Policy

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.ReclaimPolicy
version: 1.0

[ClickHouse Operator] SHALL support defining the behavior of [PVC] deletion policy
when [Pod] to which [PVC] was assinged is being deleted using
`.spec.templates.volumeClaimTemplates[].reclaimPolicy` [string] type property.

* `Delete` SHALL be the default value
* `Retain` SHALL cause the [PVC] to alive even if [Pod] is deleted

#### Volume Claim Metadata

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.Metadata
version: 1.0

[ClickHouse Operator] SHALL allow passing standard object's metadata from template to [PVC]
as specified in https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata
using `.spec.templates.volumeClaimTemplates[].metadata` object.

#### Volume Claim Spec

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.VolumeClaimTemplates.Spec
version: 1.0

[ClickHouse Operator] SHALL allow defining all aspects of [PVC] resource
as specified in https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims
using `.spec.templates.volumeClaimTemplates[].spec` object.

### Service Templates

#### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates
version: 1.0

[ClickHouse Operator] SHALL allow defining templates for rendering [Service]s
which would get endpoint from [Pod]s having either [CHI] wide, cluster wide, shard wide,
or replica wide scope level using `.spec.templates.serviceTemplates` [array] type object.

For example,

```yaml
spec:
  templates:
    serviceTemplates:
```

#### Service Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.Name
version: 1.0

[ClickHouse Operator] SHALL support specifying `ServiceTemplate` name that MAY be used
as a value in the following properties to provide default property values
for the selected resources:

* top level `.spec.defaults.templates.serviceTemplate`
* cluster level `.spec.configuration.clusters.templates.clusterServiceTemplate`
* shard level `.spec.configuration.clusters.layout.shards.temlates.shardServiceTemplate`
* replica level `.spec.configuration.clusters.layout.replicas.templates.replicaServiceTemplate`
  or `.spec.configuration.clusters.layout.shards.replicas.replicaServiceTemplate`

using `.spec.templates.serviceTemplates[].name` [string] type property.

For example,

```yaml
spec:
  templates:
    serviceTemplates:
      - name: default-service-template
```

#### Service Generate Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.GenerateName
version: 1.0

[ClickHouse Operator] SHALL support defining format for generated [Service] name
using `.spec.templates.serviceTemplates[].generateName` [string] type property
that support the following macros depending on the level of the object
for which the [Service] is being created:

**For [CHI] level [Service]**

* `{chi}` - ClickHouseInstallation name
* `{chiID}` - short hashed ClickHouseInstallation name

**For cluster level [Service]**

* `{chi}` - ClickHouseInstallation name
* `{chiID}` - short hashed ClickHouseInstallation name
* `{cluster}` - cluster name
* `{clusterID}` - short hashed cluster name
* `{clusterIndex}` - 0-based index of the cluster in the [CHI]

**For shard level [Service]**

* `{chi}` - ClickHouseInstallation name
* `{chiID}` - short hashed ClickHouseInstallation name
* `{cluster}` - cluster name
* `{clusterID}` - short hashed cluster name
* `{clusterIndex}` - 0-based index of the cluster in the [CHI]
* `{shard}` - shard name
* `{shardID}` - short hashed shard name
* `{shardIndex}` - 0-based index of the shard in the cluster

**For replica level [Service]**

* `{chi}` - ClickHouseInstallation name
* `{chiID}` - short hashed ClickHouseInstallation name
* `{cluster}` - cluster name
* `{clusterID}` - short hashed cluster name
* `{clusterIndex}` - 0-based index of the cluster in the [CHI]
* `{shard}` - shard name
* `{shardID}` - short hashed shard name
* `{shardIndex}` - 0-based index of the shard in the cluster
* `{replica}` - replica name
* `{replicaID}` - short hashed replica name
* `{replicaIndex}` - 0-based index of the replica in the shard

#### Service Generate Metadata

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.Metadata
version: 1.0

[ClickHouse Operator] SHALL allow passing standard object's metadata from template to [Service]
using  `.spec.templates.serviceTemplates[].metadata` object.

This MAY be used for defining cloud provider specific metadata that may impact the
behavior of [Service].

#### Service Spec

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.Templates.ServiceTemplates.Spec
version: 1.0

[ClickHouse Operator] SHALL allow describing the behavior of generated [Service]
as specified in https://kubernetes.io/docs/concepts/services-networking/service/
using `.spec.templates.serviceTemplates[].spec` object.

### Use Templates

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates
version: 1.0

[ClickHouse Operator] SHALL support defining a list of `ClickHouseInstallationTemplate`
resource names which will merge with current [CHI] manifest during rendering
of [Kubernetes] resources to create [ClickHouse] clusters using
`.spec.useTemplates` [array] type object.

For example,

```yaml
spec:
  # List of templates used by a CHI
  useTemplates:
```

#### Use Template Name

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates.Name
version: 1.0

[ClickHouse Operator] SHALL support defining the name of `ClickHouseInstallationTemplate`
to be used using the `.spec.useTemplates.name` [string] type property.

```yaml
spec:
  useTemplates:
    - name: template1
```

#### Use Template Namespace

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates.Namespace
version: 1.0

[ClickHouse Operator] SHALL support specifying [Kubernetes] [Namespace] where
operator needs to search for `ClickHouseInstallationTemplate` resources using
`.spec.useTemplates.namespace` [string] type property.

The available namespaces SHALL depend on the `watchNamespaces` setting in the operator.

```yaml
spec:
  useTemplates:
    - name: template1
      namespace: ns1
```

#### Use Template Use Type

##### RQ.SRS-026.ClickHouseOperator.CustomResource.Spec.UseTemplates.UseType
version: 1.0

[ClickHouse Operator] SHALL support defining merge strategy for templates
using the `.spec.useTemplates.useType` [string] type property.

Only the `merge` value SHALL be currently supported and current [CHI] settings
SHALL have higher priority than the merged `ClickHouseInstallationTemplate`.

### ClickHouse Operator Configuration

#### RQ.SRS-026.ClickHouseOperator.Configuration.Spec
version: 1.0

[ClickHouse Operator] SHALL support `spec` object in the
`ClickHouseOperatorConfiguration` resource that SHALL allow to define
settings for the operator itself.

For example,

```yaml
apiVersion: "clickhouse.altinity.com/v1"
kind: "ClickHouseOperatorConfiguration"
metadata:
  name: "chop-config-01"
spec:
```

#### Watched Namespaces

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.WatchNamespaces
version: 1.0

[ClickHouse Operator] SHALL support defining a list of namespaces where the operator watches
for events using `.spec.watchNamespaces` [array] type object where each element of the array
SHALL specify a namespace using a [string] type.

For example,

```yaml
spec:
  # List of namespaces where clickhouse-operator watches for events.
  # Concurrently running operators should watch on different namespaces
  watchNamespaces:
   - dev
   - info
   - onemore
```

#### ClickHouse Common Configs Path

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseCommonConfigsPath
version: 1.0

[ClickHouse Operator] SHALL support defining path to folder where [ClickHouse]
configuration files common for all instances within [CHI] are located using
`.spec.chCommonConfigsPath` [string] type property.

The default value SHALL be `config.d`.

#### ClickHouse Host Configs Path

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseHostConfigsPath
version: 1.0

[ClickHouse Operator] SHALL support defining path to folder where [ClickHouse]
configuration files unique for each instance (host) within [CHI] are located
`.spec.chHostConfigsPath` [string] type property.

The default value SHALL be `conf.d`.

#### ClickHouse Users Configs Path

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseUsersConfigsPath
version: 1.0

[ClickHouse Operator] SHALL support defining path to folder where [ClickHouse]
configuration files with user's settings for all instances within [CHI] are located using
`.spec.chUsersConfigsPath` [string] type property.

The default value SHALL be `users.d`.

#### Templates Path

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.TemplatesPath
version: 1.0

[ClickHouse Operator] SHALL support defining path to folder where `ClickHouseInstallation`
`.yaml` manifests are located using `.spec.chiTemplatesPath` [string] type property.

#### StatefulSet Update Timeout

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetUpdateTimeout
version: 1.0

[ClickHouse Operator] SHALL support defining how many seconds to wait for
created or updated StatefulSet to be ready using `.spec.statefulSetUpdateTimeout`
integer type property.

#### StatefulSet Update Poll Period

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetUpdatePollPeriod
version: 1.0

[ClickHouse Operator] SHALL support defining how many seconds to wait between
checks for created or updated [StatefulSet] status using
`spec.statefulSetUpdatePollPeriod` integer type property.

#### StatefulSet Create Failure Action

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetCreateFailureAction
version: 1.0

[ClickHouse Operator] SHALL support defining what to do in case created [StatefulSet]
is not in ready after `statefulSetUpdateTimeout` seconds have elapsed using
`.spec.onStatefulSetCreateFailureAction` [string] type property.

The following values SHALL be supported:

* `abort` - SHALL do nothing, just break the process and wait for admin.
* `delete` - SHALL delete newly created problematic [StatefulSet]
* `ignore` - SHALL be the default and SHALL ignore error,
  pretend nothing happened and move on to the next [StatefulSet]

#### StatefulSet Update Failure Action

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StatefulSetUpdateFailureAction
version: 1.0

[ClickHouse Operator] SHALL support defining what to do in case updated [StatefulSet]
is not in ready after `statefulSetUpdateTimeout` seconds have elapsed using
`.spec.onStatefulSetUpdateFailureAction` [string] type property.

The following values SHALL be supported:

* `abort` - SHALL do nothing, just break the process and wait for admin
* `rollback`- SHALL be the default and SHALL delete Pod and rollback [StatefulSet] to previous
  generation. [Pod] SHALL be recreated by [StatefulSet] based on rollback-ed configuration
* `ignore` - SHALL ignore error, pretend nothing happened and move on to the next [StatefulSet]

#### ClickHouse Config User Default Profile

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultProfile
version: 1.0

[ClickHouse Operator] SHALL support defining default [ClickHouse] server configuration
`<profile>...</profile>` section for any `<user>` using
`.spec.chConfigUserDefaultProfile` [string] type property.

#### ClickHouse Config User Default Quota

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultQuota
version: 1.0

[ClickHouse Operator] SHALL support defining default [ClickHouse] server configuration
`<quota>...</quota>` section for any `<user>` using `.spec.chConfigUserDefaultQuota` [string]
type property.

#### ClickHouse Config User Default Networks IP

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultNetworksIP
version: 1.0

[ClickHouse Operator] SHALL support defining default [ClickHouse] server configuration
`<networks><ip>...</ip></networks>` section for any `<user>` using
`.spec.chConfigUserDefaultNetworksIP` [array] type object with each item having
[string] type.

For example,

```yaml
spec:
  chConfigUserDefaultNetworksIP:
    - "::/0"
```

#### ClickHouse Config User Default Password

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigUserDefaultPassword
version: 1.0

[ClickHouse Operator] SHALL support defining default [ClickHouse] server configuration
`<password>...</password>` section for any `<user>` using
`.spec.chConfigUserDefaultPassword` [string] type property.

For example,

```yaml
spec:
  chConfigUserDefaultPassword: "default"
```

#### ClickHouse Config Networks Host Regexp Template

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseConfigNetworksHostRegexpTemplate
version: 1.0

[ClickHouse Operator] SHALL support defining [ClickHouse] server configuration
`<host_regexp>...</host_regexp>` section for any `<user>` using
`.spec.chConfigNetworksHostRegexpTemplate` [string] type property.

#### ClickHouse Credentials Secret Namespace

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseCredentialsSecretNamespace
version: 1.0

[ClickHouse Operator] SHALL support defining [Namespace] for [Kubernetes] secret with
username and password to be used by operator to connect to [ClickHouse] instances
using `.spec.chCredentialsSecretNamespace` [string] type property.

#### ClickHouse Credentials Secret Name

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHouseCredentialsSecretName
version: 1.0

[ClickHouse Operator] SHALL support defining name of [Kubernetes] secret with username
and password to be used by operator to connect to [ClickHouse] instances
using `.spec.chCredentialsSecretName` [string] type property.

#### ClickHouse Port

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ClickHousePort
version: 1.0

[ClickHouse Operator] SHALL support defining [ClickHouse] port to be used by operator
to connect to [ClickHouse] instances using `.spec.chPort` [integer] type property
in the range from `1` to `65535`.

#### Log To `stderr`

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.LogToStderr
version: 1.0

[ClickHouse Operator] SHALL support allowing writing logs to `stderr` using
`.spec.logtostderr` [string] type property that SHALL have a boolean value.

#### Log To `stderr` And Files

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.AlsoLogToStderr
version: 1.0

[ClickHouse Operator] SHALL support allowing to write logs to stderr and files at the same
time using `.spec.alsologtostderr` [string] type property that SHALL have a boolean value.

#### Verbosity Level

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.VerbosityLevel
version: 1.0

[ClickHouse Operator] SHALL support allowing verbosity level of the operator logging
using `.spec.v` [string] type property.

The default SHALL be `1` and max level SHALL be `9`.

#### Threshold For `stderr`

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.StderrThreshold
version: 1.0

[ClickHouse Operator] SHALL support defining threshold for writing log to
`stderr` using `.spec.stderrthreshold` [string] type property.

#### V Module

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.VModule
version: 1.0

[ClickHouse Operator] SHALL support `.spec.vmodule` [string] type property.

#### Logging Backtrace

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.LogBacktrace
version: 1.0

[ClickHouse Operator] SHALL support `.spec.log_backtrace_at` [string] type property.

#### Number Of Threads For Reconciliation Cycle

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ReconcileThreadsNumber
version: 1.0

[ClickHouse Operator] SHALL support defining how many goroutines SHALL be used
for reconciliation cycle in parallel using `.spec.reconcileThreadsNumber` [integer]
type property in range from `1` to `65535`.

The default SHALL be `10`.

#### Wait Exclude For Reconciliation Cycle

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ReconcileWaitExclude
version: 1.0

[ClickHouse Operator] SHALL support `.spec.reconcileWaitExclude` [string] type property.

#### Wait Include For Reconciliation Cycle

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ReconcileWaitInclude
version: 1.0

[ClickHouse Operator] SHALL support `.spec.reconcileWaitInclude` [string] type property.

#### Excluding From Propagation Labels

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.ExcludeFromPropagationLabels
version: 1.0

[ClickHouse Operator] SHALL support defining which labels SHALL be excluded when
propagating labels from the [CHI]'s `metadata.labels` section to child objects' `metadata.labels`
using `.spec.excludeFromPropagationLabels` [array]
type object where each item is of [string] type and specifies the label to exclude.

#### Appending Scope Labels

##### RQ.SRS-026.ClickHouseOperator.Configuration.Spec.AppendScopeLabels
version: 1.0

[ClickHouse Operator] SHALL support defining whether to append `scope` labels to
[StatefulSet] and [Pod] using `.spec.appendScopeLabels` [string] type property
that SHALL either be set to [bool enum] value or one of the following values:

* `"LabelShardScopeIndex"`
* `"LabelReplicaScopeIndex"`
* `"LabelCHIScopeIndex"`
* `"LabelCHIScopeCycleSize"`
* `"LabelCHIScopeCycleIndex"`
* `"LabelCHIScopeCycleOffset"`
* `"LabelClusterScopeIndex"`
* `"LabelClusterScopeCycleSize"`
* `"LabelClusterScopeCycleIndex"`
* `"LabelClusterScopeCycleOffset"`

### Stateful Sets

#### RQ.SRS-026.ClickHouseOperator.StatefulSets
version: 1.0

[ClickHouse Operator] SHALL use [StatefulSets] to manage pods that are based
on an identical container spec.

#### Sticky Identity

##### RQ.SRS-026.ClickHouseOperator.StatefulSets.PodsStickyIdentity
version: 1.0

[ClickHouse Operator] SHALL use [StatefulSets] that maintain a sticky identity
for each of their pods.

#### Pods Created From The Same Spec

##### RQ.SRS-026.ClickHouseOperator.StatefulSets.PodsCreatedFromTheSameSpec
version: 1.0

[ClickHouse Operator] SHALL create pods that are created from the same spec but are
not interchangeable. This means that each pod SHALL have a persistent identifier
that it SHALL maintain across any rescheduling.

### Error Handling

#### RQ.SRS-026.ClickHouseOperator.ErrorHandling
version: 1.0

[ClickHouse Operator] SHALL support handling cases when [StatefulSet] would
not reach `Ready` status.

For example,

* invalid [ClickHouse] server image
* invalid [ClickHouse] server `users.xml` or `config.xml` configuration files

#### Health Monitoring

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.HealthMonitoring
version: 1.0

[ClickHouse Operator] SHALL support health monitoring of updated or created
[StatefulSets] when performing rolling update or create procedures.

#### Polling For Ready

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.PollingForReady
version: 1.0

[ClickHouse Operator] SHALL support polling [StatefulSet] status and wait
for some configurable time for [StatefulSet] to report `Ready` status to be reached.

#### Move On Ready

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.MoveOnReady
version: 1.0

[ClickHouse Operator] SHALL support moving on to the next [StatefulSet]
when operation on the current [StatefulSet] successfully reports `Ready` status

#### Create Failure

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.Create
version: 1.0

[ClickHouse Operator] SHALL support the following options in the case
of [StatefulSet] create failure after `statefulSetUpdateTimeout` seconds
has passed

* `abort` - SHALL do nothing and SHALL just break the process and wait for admin
* `delete` - SHALL delete newly created problematic StatefulSet

If not specified, `abort` SHALL be the default behavior.

For example,

```yml
onStatefulSetCreateFailureAction: delete
```

#### Update Failure

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.Update
version: 1.0

[ClickHouse Operator] SHALL support the following options in the case
of [StatefulSet] update failure after `statefulSetUpdateTimeout` seconds
has passed

* `abort` - SHALL do nothing and SHALL just break the process and wait for admin
* `rollback` - SHALL delete Pod and rollback [StatefulSet] to previous generation.

If not specified, `abort` SHALL be the default behavior.

For example,

```yml
onStatefulSetUpdateFailureAction: rollback
```

#### Reverting Back

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.Fails.RevertBack.Create
version: 1.0

[ClickHouse Operator] SHALL support reverting back after [StatefulSet] create failure.

##### RQ.SRS-026.ClickHouseOperator.ErrorHandling.Fails.RevertBack.Update
version: 1.0

[ClickHouse Operator] SHALL support reverting back after [StatefulSet] update failure.

#### Successful Update Before Failed

###### RQ.SRS-026.ClickHouseOperator.ErrorHandling.SuccessfulUpdateBeforeFailed.DoNothing
version: 1.0

[ClickHouse Operator] SHALL do nothing if [StatefulSets] were already successfully
updated on the same run before failed [StatefulSet] met.

[Operator]: #operator
[operator]: #operator
[ReplicaSet]: #replicaset
[Namespace]: #namespace
[OLM]: #olm
[Deployment]: #deployment
[SRS]: #srs
[CHI]: #chi
[PVC]: #pvc
[Pod]: #pod
[Pods]: #pod
[Service]: #service
[bool enum]: #bool-enum-type
[string]: #string-type
[integer]: #integer-type
[array]: #array-type
[ConfigMap]: #configmap
[ConfigMaps]: #configmap
[StatefulSet]: #statefulset
[StatefulSets]: #statefulset
[custom resource definition]: https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/
[Altinity]: https://altinity.com
[ZooKeeper]: https://zookeeper.apache.org/
[Prometheus]: https://prometheus.io/
[Kubernetes]: https://kubernetes.io/
[Clickhouse Operator]: https://github.com/Altinity/clickhouse-operator
[ClickHouse]: https://clickhouse.tech
[Gitlab repository]: https://gitlab.com/altinity-qa/documents/qa-srs026-clickhouse-operator/blob/main/QA_SRS026_ClickHouse_Operator.md
[Revision history]: https://gitlab.com/altinity-qa/documents/qa-srs026-clickhouse-operator/commits/main/QA_SRS026_ClickHouse_Operator.md
[Git]: https://git-scm.com/
[GitLab]: https://gitlab.com

